{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"name":"Sentiment Classification with Transformers","provenance":[{"file_id":"1f32gj5IYIyFipoINiC8P3DvKat-WWLUK","timestamp":1604612373870}],"collapsed_sections":[],"machine_shape":"hm"},"kernelspec":{"name":"python3","display_name":"Python 3"},"accelerator":"GPU","widgets":{"application/vnd.jupyter.widget-state+json":{"33aa1abf123541158de12632ac6f3cab":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_57a4fd2ab9e04d2d82d9fde9943ebe8c","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_2e8f3e58b7224d01b65b98c621d72144","IPY_MODEL_013b3fde6d9a47ddbe76c8c773b3db03"]}},"57a4fd2ab9e04d2d82d9fde9943ebe8c":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"2e8f3e58b7224d01b65b98c621d72144":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_52a2ca9193d24052852ef24c19cb7d23","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":231508,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":231508,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_a67da284b353409d871eceb0ba9e4881"}},"013b3fde6d9a47ddbe76c8c773b3db03":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_561664df800742c4b8eaa184bdeebe66","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 232k/232k [00:00&lt;00:00, 481kB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_d5efa4c29da2408eaa077e9c3089c77a"}},"52a2ca9193d24052852ef24c19cb7d23":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"a67da284b353409d871eceb0ba9e4881":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"561664df800742c4b8eaa184bdeebe66":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"d5efa4c29da2408eaa077e9c3089c77a":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}}}}},"cells":[{"cell_type":"code","metadata":{"id":"_lTXsMK3sNYr","executionInfo":{"status":"ok","timestamp":1607564096435,"user_tz":480,"elapsed":1804,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["import os\n","import re\n","from tqdm import tqdm\n","import numpy as np\n","import pandas as pd\n","import matplotlib.pyplot as plt\n","from sklearn.metrics import accuracy_score, roc_curve, auc\n","%matplotlib inline"],"execution_count":1,"outputs":[]},{"cell_type":"code","metadata":{"id":"u2c6mWB0XHtM","colab":{"resources":{"http://localhost:8080/nbextensions/google.colab/files.js":{"data":"Ly8gQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQwovLwovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgovLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKLy8KLy8gICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKLy8KLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQovLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAovLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KLy8gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAovLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCi8qKgogKiBAZmlsZW92ZXJ2aWV3IEhlbHBlcnMgZm9yIGdvb2dsZS5jb2xhYiBQeXRob24gbW9kdWxlLgogKi8KKGZ1bmN0aW9uKHNjb3BlKSB7CmZ1bmN0aW9uIHNwYW4odGV4dCwgc3R5bGVBdHRyaWJ1dGVzID0ge30pIHsKICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogIGVsZW1lbnQudGV4dENvbnRlbnQgPSB0ZXh0OwogIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHN0eWxlQXR0cmlidXRlcykpIHsKICAgIGVsZW1lbnQuc3R5bGVba2V5XSA9IHN0eWxlQXR0cmlidXRlc1trZXldOwogIH0KICByZXR1cm4gZWxlbWVudDsKfQoKLy8gTWF4IG51bWJlciBvZiBieXRlcyB3aGljaCB3aWxsIGJlIHVwbG9hZGVkIGF0IGEgdGltZS4KY29uc3QgTUFYX1BBWUxPQURfU0laRSA9IDEwMCAqIDEwMjQ7CgpmdW5jdGlvbiBfdXBsb2FkRmlsZXMoaW5wdXRJZCwgb3V0cHV0SWQpIHsKICBjb25zdCBzdGVwcyA9IHVwbG9hZEZpbGVzU3RlcChpbnB1dElkLCBvdXRwdXRJZCk7CiAgY29uc3Qgb3V0cHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG91dHB1dElkKTsKICAvLyBDYWNoZSBzdGVwcyBvbiB0aGUgb3V0cHV0RWxlbWVudCB0byBtYWtlIGl0IGF2YWlsYWJsZSBmb3IgdGhlIG5leHQgY2FsbAogIC8vIHRvIHVwbG9hZEZpbGVzQ29udGludWUgZnJvbSBQeXRob24uCiAgb3V0cHV0RWxlbWVudC5zdGVwcyA9IHN0ZXBzOwoKICByZXR1cm4gX3VwbG9hZEZpbGVzQ29udGludWUob3V0cHV0SWQpOwp9CgovLyBUaGlzIGlzIHJvdWdobHkgYW4gYXN5bmMgZ2VuZXJhdG9yIChub3Qgc3VwcG9ydGVkIGluIHRoZSBicm93c2VyIHlldCksCi8vIHdoZXJlIHRoZXJlIGFyZSBtdWx0aXBsZSBhc3luY2hyb25vdXMgc3RlcHMgYW5kIHRoZSBQeXRob24gc2lkZSBpcyBnb2luZwovLyB0byBwb2xsIGZvciBjb21wbGV0aW9uIG9mIGVhY2ggc3RlcC4KLy8gVGhpcyB1c2VzIGEgUHJvbWlzZSB0byBibG9jayB0aGUgcHl0aG9uIHNpZGUgb24gY29tcGxldGlvbiBvZiBlYWNoIHN0ZXAsCi8vIHRoZW4gcGFzc2VzIHRoZSByZXN1bHQgb2YgdGhlIHByZXZpb3VzIHN0ZXAgYXMgdGhlIGlucHV0IHRvIHRoZSBuZXh0IHN0ZXAuCmZ1bmN0aW9uIF91cGxvYWRGaWxlc0NvbnRpbnVlKG91dHB1dElkKSB7CiAgY29uc3Qgb3V0cHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG91dHB1dElkKTsKICBjb25zdCBzdGVwcyA9IG91dHB1dEVsZW1lbnQuc3RlcHM7CgogIGNvbnN0IG5leHQgPSBzdGVwcy5uZXh0KG91dHB1dEVsZW1lbnQubGFzdFByb21pc2VWYWx1ZSk7CiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXh0LnZhbHVlLnByb21pc2UpLnRoZW4oKHZhbHVlKSA9PiB7CiAgICAvLyBDYWNoZSB0aGUgbGFzdCBwcm9taXNlIHZhbHVlIHRvIG1ha2UgaXQgYXZhaWxhYmxlIHRvIHRoZSBuZXh0CiAgICAvLyBzdGVwIG9mIHRoZSBnZW5lcmF0b3IuCiAgICBvdXRwdXRFbGVtZW50Lmxhc3RQcm9taXNlVmFsdWUgPSB2YWx1ZTsKICAgIHJldHVybiBuZXh0LnZhbHVlLnJlc3BvbnNlOwogIH0pOwp9CgovKioKICogR2VuZXJhdG9yIGZ1bmN0aW9uIHdoaWNoIGlzIGNhbGxlZCBiZXR3ZWVuIGVhY2ggYXN5bmMgc3RlcCBvZiB0aGUgdXBsb2FkCiAqIHByb2Nlc3MuCiAqIEBwYXJhbSB7c3RyaW5nfSBpbnB1dElkIEVsZW1lbnQgSUQgb2YgdGhlIGlucHV0IGZpbGUgcGlja2VyIGVsZW1lbnQuCiAqIEBwYXJhbSB7c3RyaW5nfSBvdXRwdXRJZCBFbGVtZW50IElEIG9mIHRoZSBvdXRwdXQgZGlzcGxheS4KICogQHJldHVybiB7IUl0ZXJhYmxlPCFPYmplY3Q+fSBJdGVyYWJsZSBvZiBuZXh0IHN0ZXBzLgogKi8KZnVuY3Rpb24qIHVwbG9hZEZpbGVzU3RlcChpbnB1dElkLCBvdXRwdXRJZCkgewogIGNvbnN0IGlucHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlucHV0SWQpOwogIGlucHV0RWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlOwoKICBjb25zdCBvdXRwdXRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3V0cHV0SWQpOwogIG91dHB1dEVsZW1lbnQuaW5uZXJIVE1MID0gJyc7CgogIGNvbnN0IHBpY2tlZFByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7CiAgICAgIHJlc29sdmUoZS50YXJnZXQuZmlsZXMpOwogICAgfSk7CiAgfSk7CgogIGNvbnN0IGNhbmNlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogIGlucHV0RWxlbWVudC5wYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKGNhbmNlbCk7CiAgY2FuY2VsLnRleHRDb250ZW50ID0gJ0NhbmNlbCB1cGxvYWQnOwogIGNvbnN0IGNhbmNlbFByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgY2FuY2VsLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgIHJlc29sdmUobnVsbCk7CiAgICB9OwogIH0pOwoKICAvLyBXYWl0IGZvciB0aGUgdXNlciB0byBwaWNrIHRoZSBmaWxlcy4KICBjb25zdCBmaWxlcyA9IHlpZWxkIHsKICAgIHByb21pc2U6IFByb21pc2UucmFjZShbcGlja2VkUHJvbWlzZSwgY2FuY2VsUHJvbWlzZV0pLAogICAgcmVzcG9uc2U6IHsKICAgICAgYWN0aW9uOiAnc3RhcnRpbmcnLAogICAgfQogIH07CgogIGNhbmNlbC5yZW1vdmUoKTsKCiAgLy8gRGlzYWJsZSB0aGUgaW5wdXQgZWxlbWVudCBzaW5jZSBmdXJ0aGVyIHBpY2tzIGFyZSBub3QgYWxsb3dlZC4KICBpbnB1dEVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlOwoKICBpZiAoIWZpbGVzKSB7CiAgICByZXR1cm4gewogICAgICByZXNwb25zZTogewogICAgICAgIGFjdGlvbjogJ2NvbXBsZXRlJywKICAgICAgfQogICAgfTsKICB9CgogIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykgewogICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpOwogICAgbGkuYXBwZW5kKHNwYW4oZmlsZS5uYW1lLCB7Zm9udFdlaWdodDogJ2JvbGQnfSkpOwogICAgbGkuYXBwZW5kKHNwYW4oCiAgICAgICAgYCgke2ZpbGUudHlwZSB8fCAnbi9hJ30pIC0gJHtmaWxlLnNpemV9IGJ5dGVzLCBgICsKICAgICAgICBgbGFzdCBtb2RpZmllZDogJHsKICAgICAgICAgICAgZmlsZS5sYXN0TW9kaWZpZWREYXRlID8gZmlsZS5sYXN0TW9kaWZpZWREYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygpIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ24vYSd9IC0gYCkpOwogICAgY29uc3QgcGVyY2VudCA9IHNwYW4oJzAlIGRvbmUnKTsKICAgIGxpLmFwcGVuZENoaWxkKHBlcmNlbnQpOwoKICAgIG91dHB1dEVsZW1lbnQuYXBwZW5kQ2hpbGQobGkpOwoKICAgIGNvbnN0IGZpbGVEYXRhUHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZSkgPT4gewogICAgICAgIHJlc29sdmUoZS50YXJnZXQucmVzdWx0KTsKICAgICAgfTsKICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGUpOwogICAgfSk7CiAgICAvLyBXYWl0IGZvciB0aGUgZGF0YSB0byBiZSByZWFkeS4KICAgIGxldCBmaWxlRGF0YSA9IHlpZWxkIHsKICAgICAgcHJvbWlzZTogZmlsZURhdGFQcm9taXNlLAogICAgICByZXNwb25zZTogewogICAgICAgIGFjdGlvbjogJ2NvbnRpbnVlJywKICAgICAgfQogICAgfTsKCiAgICAvLyBVc2UgYSBjaHVua2VkIHNlbmRpbmcgdG8gYXZvaWQgbWVzc2FnZSBzaXplIGxpbWl0cy4gU2VlIGIvNjIxMTU2NjAuCiAgICBsZXQgcG9zaXRpb24gPSAwOwogICAgd2hpbGUgKHBvc2l0aW9uIDwgZmlsZURhdGEuYnl0ZUxlbmd0aCkgewogICAgICBjb25zdCBsZW5ndGggPSBNYXRoLm1pbihmaWxlRGF0YS5ieXRlTGVuZ3RoIC0gcG9zaXRpb24sIE1BWF9QQVlMT0FEX1NJWkUpOwogICAgICBjb25zdCBjaHVuayA9IG5ldyBVaW50OEFycmF5KGZpbGVEYXRhLCBwb3NpdGlvbiwgbGVuZ3RoKTsKICAgICAgcG9zaXRpb24gKz0gbGVuZ3RoOwoKICAgICAgY29uc3QgYmFzZTY0ID0gYnRvYShTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGNodW5rKSk7CiAgICAgIHlpZWxkIHsKICAgICAgICByZXNwb25zZTogewogICAgICAgICAgYWN0aW9uOiAnYXBwZW5kJywKICAgICAgICAgIGZpbGU6IGZpbGUubmFtZSwKICAgICAgICAgIGRhdGE6IGJhc2U2NCwKICAgICAgICB9LAogICAgICB9OwogICAgICBwZXJjZW50LnRleHRDb250ZW50ID0KICAgICAgICAgIGAke01hdGgucm91bmQoKHBvc2l0aW9uIC8gZmlsZURhdGEuYnl0ZUxlbmd0aCkgKiAxMDApfSUgZG9uZWA7CiAgICB9CiAgfQoKICAvLyBBbGwgZG9uZS4KICB5aWVsZCB7CiAgICByZXNwb25zZTogewogICAgICBhY3Rpb246ICdjb21wbGV0ZScsCiAgICB9CiAgfTsKfQoKc2NvcGUuZ29vZ2xlID0gc2NvcGUuZ29vZ2xlIHx8IHt9OwpzY29wZS5nb29nbGUuY29sYWIgPSBzY29wZS5nb29nbGUuY29sYWIgfHwge307CnNjb3BlLmdvb2dsZS5jb2xhYi5fZmlsZXMgPSB7CiAgX3VwbG9hZEZpbGVzLAogIF91cGxvYWRGaWxlc0NvbnRpbnVlLAp9Owp9KShzZWxmKTsK","ok":true,"headers":[["content-type","application/javascript"]],"status":200,"status_text":""}},"base_uri":"https://localhost:8080/","height":72},"executionInfo":{"status":"ok","timestamp":1607463449667,"user_tz":480,"elapsed":35106,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"a19a76ee-2491-4377-948e-0a6db18e7922"},"source":["from google.colab import files\n","uploaded = files.upload()"],"execution_count":1,"outputs":[{"output_type":"display_data","data":{"text/html":["\n","     <input type=\"file\" id=\"files-9e779d01-6788-4ffd-b82c-07970092e1b3\" name=\"files[]\" multiple disabled\n","        style=\"border:none\" />\n","     <output id=\"result-9e779d01-6788-4ffd-b82c-07970092e1b3\">\n","      Upload widget is only available when the cell has been executed in the\n","      current browser session. Please rerun this cell to enable.\n","      </output>\n","      <script src=\"/nbextensions/google.colab/files.js\"></script> "],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["Saving Tweets.csv to Tweets.csv\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"LzBj01foXTVR","colab":{"base_uri":"https://localhost:8080/","height":445},"executionInfo":{"status":"ok","timestamp":1607564126294,"user_tz":480,"elapsed":698,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"9d1eda83-2d7a-4a1d-d5f6-7d797df0018b"},"source":["Airline = pd.read_csv('Tweets.csv')\n","Airline.head(5)"],"execution_count":2,"outputs":[{"output_type":"execute_result","data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>tweet_id</th>\n","      <th>airline_sentiment</th>\n","      <th>airline_sentiment_confidence</th>\n","      <th>negativereason</th>\n","      <th>negativereason_confidence</th>\n","      <th>airline</th>\n","      <th>airline_sentiment_gold</th>\n","      <th>name</th>\n","      <th>negativereason_gold</th>\n","      <th>retweet_count</th>\n","      <th>text</th>\n","      <th>tweet_coord</th>\n","      <th>tweet_created</th>\n","      <th>tweet_location</th>\n","      <th>user_timezone</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>570306133677760513</td>\n","      <td>neutral</td>\n","      <td>1.0000</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>Virgin America</td>\n","      <td>NaN</td>\n","      <td>cairdin</td>\n","      <td>NaN</td>\n","      <td>0</td>\n","      <td>@VirginAmerica What @dhepburn said.</td>\n","      <td>NaN</td>\n","      <td>2015-02-24 11:35:52 -0800</td>\n","      <td>NaN</td>\n","      <td>Eastern Time (US &amp; Canada)</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>570301130888122368</td>\n","      <td>positive</td>\n","      <td>0.3486</td>\n","      <td>NaN</td>\n","      <td>0.0000</td>\n","      <td>Virgin America</td>\n","      <td>NaN</td>\n","      <td>jnardino</td>\n","      <td>NaN</td>\n","      <td>0</td>\n","      <td>@VirginAmerica plus you've added commercials t...</td>\n","      <td>NaN</td>\n","      <td>2015-02-24 11:15:59 -0800</td>\n","      <td>NaN</td>\n","      <td>Pacific Time (US &amp; Canada)</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>570301083672813571</td>\n","      <td>neutral</td>\n","      <td>0.6837</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>Virgin America</td>\n","      <td>NaN</td>\n","      <td>yvonnalynn</td>\n","      <td>NaN</td>\n","      <td>0</td>\n","      <td>@VirginAmerica I didn't today... Must mean I n...</td>\n","      <td>NaN</td>\n","      <td>2015-02-24 11:15:48 -0800</td>\n","      <td>Lets Play</td>\n","      <td>Central Time (US &amp; Canada)</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>570301031407624196</td>\n","      <td>negative</td>\n","      <td>1.0000</td>\n","      <td>Bad Flight</td>\n","      <td>0.7033</td>\n","      <td>Virgin America</td>\n","      <td>NaN</td>\n","      <td>jnardino</td>\n","      <td>NaN</td>\n","      <td>0</td>\n","      <td>@VirginAmerica it's really aggressive to blast...</td>\n","      <td>NaN</td>\n","      <td>2015-02-24 11:15:36 -0800</td>\n","      <td>NaN</td>\n","      <td>Pacific Time (US &amp; Canada)</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>570300817074462722</td>\n","      <td>negative</td>\n","      <td>1.0000</td>\n","      <td>Can't Tell</td>\n","      <td>1.0000</td>\n","      <td>Virgin America</td>\n","      <td>NaN</td>\n","      <td>jnardino</td>\n","      <td>NaN</td>\n","      <td>0</td>\n","      <td>@VirginAmerica and it's a really big bad thing...</td>\n","      <td>NaN</td>\n","      <td>2015-02-24 11:14:45 -0800</td>\n","      <td>NaN</td>\n","      <td>Pacific Time (US &amp; Canada)</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["             tweet_id  ...               user_timezone\n","0  570306133677760513  ...  Eastern Time (US & Canada)\n","1  570301130888122368  ...  Pacific Time (US & Canada)\n","2  570301083672813571  ...  Central Time (US & Canada)\n","3  570301031407624196  ...  Pacific Time (US & Canada)\n","4  570300817074462722  ...  Pacific Time (US & Canada)\n","\n","[5 rows x 15 columns]"]},"metadata":{"tags":[]},"execution_count":2}]},{"cell_type":"code","metadata":{"id":"dWu2uZHmW_HY","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607564129759,"user_tz":480,"elapsed":690,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"3b4efeb4-377f-4038-f064-f1dbd8e96688"},"source":["Airline['airline_sentiment'][Airline['airline_sentiment'] == 'neutral'] = 1\n","Airline['airline_sentiment'][Airline['airline_sentiment'] == 'positive'] = 2\n","Airline['airline_sentiment'][Airline['airline_sentiment'] == 'negative'] = 0"],"execution_count":3,"outputs":[{"output_type":"stream","text":["/usr/local/lib/python3.6/dist-packages/ipykernel_launcher.py:1: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  \"\"\"Entry point for launching an IPython kernel.\n","/usr/local/lib/python3.6/dist-packages/ipykernel_launcher.py:2: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  \n","/usr/local/lib/python3.6/dist-packages/ipykernel_launcher.py:3: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  This is separate from the ipykernel package so we can avoid doing imports until\n"],"name":"stderr"}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":204},"id":"HNL4VIUz6DHr","executionInfo":{"status":"ok","timestamp":1607564170790,"user_tz":480,"elapsed":577,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"b5e00648-69ee-4481-f11e-954e25799dbd"},"source":["Airline = Airline[['airline_sentiment','text']]\n","Airline.rename(columns={'airline_sentiment':'labels','text':'context'},inplace=True)\n","Airline.head(5)"],"execution_count":7,"outputs":[{"output_type":"execute_result","data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>labels</th>\n","      <th>context</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>14332</th>\n","      <td>0</td>\n","      <td>@AmericanAir this might look good but the pita...</td>\n","    </tr>\n","    <tr>\n","      <th>9969</th>\n","      <td>0</td>\n","      <td>@USAirways -- I've been on hold 40 mins to Can...</td>\n","    </tr>\n","    <tr>\n","      <th>10710</th>\n","      <td>0</td>\n","      <td>@USAirways new slogan should be \"if you don't ...</td>\n","    </tr>\n","    <tr>\n","      <th>13996</th>\n","      <td>0</td>\n","      <td>@AmericanAir what happened?? We didn't get a n...</td>\n","    </tr>\n","    <tr>\n","      <th>5851</th>\n","      <td>0</td>\n","      <td>@SouthwestAir my Flt was delayed, scheduled to...</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["      labels                                            context\n","14332      0  @AmericanAir this might look good but the pita...\n","9969       0  @USAirways -- I've been on hold 40 mins to Can...\n","10710      0  @USAirways new slogan should be \"if you don't ...\n","13996      0  @AmericanAir what happened?? We didn't get a n...\n","5851       0  @SouthwestAir my Flt was delayed, scheduled to..."]},"metadata":{"tags":[]},"execution_count":7}]},{"cell_type":"markdown","metadata":{"id":"pwlL0xe1STGv"},"source":["Apple"]},{"cell_type":"code","metadata":{"id":"16bpKDmuRFMD"},"source":["Apple = pd.read_csv('Apple-Twitter-Sentiment-DFE.csv', error_bad_lines=True, encoding= 'Latin-1')\n","Apple.head(5)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"2a1SUMulRbhO"},"source":["Apple = Apple[Apple['sentiment'] != 'not_relevant']\n","Apple['sentiment'][Apple['sentiment'] == '1'] = 0\n","Apple['sentiment'][Apple['sentiment'] == '3'] = 1\n","Apple['sentiment'][Apple['sentiment'] == '5'] = 2"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"HKk6MOiqaxy-","executionInfo":{"status":"ok","timestamp":1607482423295,"user_tz":480,"elapsed":294,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["data = Apple.copy()"],"execution_count":342,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"4OAbIDUDR8CY","executionInfo":{"status":"ok","timestamp":1607474539372,"user_tz":480,"elapsed":501,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"4dacaefa-3d3e-4fab-87ce-9995a8c71d7f"},"source":["Apple = Apple[['sentiment','text']]\n","Apple.rename(columns = {'sentiment':'labels','text':'context'},inplace=True)\n","Apple['labels'].value_counts()"],"execution_count":32,"outputs":[{"output_type":"execute_result","data":{"text/plain":["1    2162\n","0    1219\n","2     423\n","Name: labels, dtype: int64"]},"metadata":{"tags":[]},"execution_count":32}]},{"cell_type":"markdown","metadata":{"id":"IYK-jc1ySNrX"},"source":["senti2017"]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"qJbOZKY4xaMv","executionInfo":{"status":"ok","timestamp":1607474565479,"user_tz":480,"elapsed":509,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"4b083ad9-308c-400f-a09f-8d0409d988bd"},"source":["with open('SemEval2017-task4-dev.subtask-A.english.INPUT.txt', \"r\") as file1:\n","    FileContent = file1.read()\n","    print(FileContent)"],"execution_count":33,"outputs":[{"output_type":"stream","text":["IOPub data rate exceeded.\n","The notebook server will temporarily stop sending output\n","to the client in order to avoid crashing it.\n","To change this limit, set the config variable\n","`--NotebookApp.iopub_data_rate_limit`.\n","\n","Current values:\n","NotebookApp.iopub_data_rate_limit=1000000.0 (bytes/sec)\n","NotebookApp.rate_limit_window=3.0 (secs)\n","\n"],"name":"stderr"}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":204},"id":"RfZ1671uxgW1","executionInfo":{"status":"ok","timestamp":1607474567786,"user_tz":480,"elapsed":967,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"2304b4c9-f8ac-48a1-9e45-ebce134900ab"},"source":["df = pd.read_csv('SemEval2017-task4-dev.subtask-A.english.INPUT.txt',sep='\\t',header=None)\n","df.rename(columns = {1: \"labels\", 2:\"context\"},inplace = True)\n","df.head(5)"],"execution_count":34,"outputs":[{"output_type":"execute_result","data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>0</th>\n","      <th>labels</th>\n","      <th>context</th>\n","      <th>3</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>619950566786113536</td>\n","      <td>neutral</td>\n","      <td>Picturehouse's, Pink Floyd's, 'Roger Waters: T...</td>\n","      <td>NaN</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>619969366986235905</td>\n","      <td>neutral</td>\n","      <td>Order Go Set a Watchman in store or through ou...</td>\n","      <td>NaN</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>619971047195045888</td>\n","      <td>negative</td>\n","      <td>If these runway renovations at the airport pre...</td>\n","      <td>NaN</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>619974445185302528</td>\n","      <td>neutral</td>\n","      <td>If you could ask an onstage interview question...</td>\n","      <td>NaN</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>619987808317407232</td>\n","      <td>positive</td>\n","      <td>A portion of book sales from our Harper Lee/Go...</td>\n","      <td>NaN</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                    0  ...    3\n","0  619950566786113536  ...  NaN\n","1  619969366986235905  ...  NaN\n","2  619971047195045888  ...  NaN\n","3  619974445185302528  ...  NaN\n","4  619987808317407232  ...  NaN\n","\n","[5 rows x 4 columns]"]},"metadata":{"tags":[]},"execution_count":34}]},{"cell_type":"code","metadata":{"id":"P4w1OdCdxqKc","executionInfo":{"status":"ok","timestamp":1607474572803,"user_tz":480,"elapsed":755,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["data =df.copy()"],"execution_count":35,"outputs":[]},{"cell_type":"code","metadata":{"id":"ecGo7HEkY16J","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607474575015,"user_tz":480,"elapsed":538,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"846d3314-d154-4165-ad75-816b39c4d243"},"source":["data['labels'][data['labels'] == 'neutral'] = 1\n","data['labels'][data['labels'] == 'positive'] = 2\n","data['labels'][data['labels'] == 'negative'] = 0"],"execution_count":36,"outputs":[{"output_type":"stream","text":["/usr/local/lib/python3.6/dist-packages/ipykernel_launcher.py:1: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  \"\"\"Entry point for launching an IPython kernel.\n","/usr/local/lib/python3.6/dist-packages/ipykernel_launcher.py:2: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  \n","/usr/local/lib/python3.6/dist-packages/ipykernel_launcher.py:3: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  This is separate from the ipykernel package so we can avoid doing imports until\n"],"name":"stderr"}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"ahT2mgjv5N8o","executionInfo":{"status":"ok","timestamp":1607474593724,"user_tz":480,"elapsed":443,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"ab3224b7-6ef1-462b-cfbf-7fdaff35516c"},"source":["SemEval = data.copy()\n","SemEval = SemEval[['labels','context']]\n","SemEval['labels'].value_counts()"],"execution_count":37,"outputs":[{"output_type":"execute_result","data":{"text/plain":["1    10342\n","2     7059\n","0     3231\n","Name: labels, dtype: int64"]},"metadata":{"tags":[]},"execution_count":37}]},{"cell_type":"markdown","metadata":{"id":"YXbSszZ46PiL"},"source":["Final dataset"]},{"cell_type":"code","metadata":{"id":"uU_CJv1i6RUP","colab":{"base_uri":"https://localhost:8080/","height":181},"executionInfo":{"status":"error","timestamp":1607560671669,"user_tz":480,"elapsed":494,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"dab63d55-33bf-49e4-b1da-e7f829475013"},"source":["df = pd.concat([Apple,Airline,SemEval])\n","df.dropna(axis=0,how='any',inplace=True)"],"execution_count":10,"outputs":[{"output_type":"error","ename":"NameError","evalue":"ignored","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)","\u001b[0;32m<ipython-input-10-f67baae0778a>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m()\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0mdf\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mpd\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mconcat\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0mApple\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mAirline\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mSemEval\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      2\u001b[0m \u001b[0mdf\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdropna\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0maxis\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m0\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mhow\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m'any'\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0minplace\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mTrue\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mNameError\u001b[0m: name 'Apple' is not defined"]}]},{"cell_type":"code","metadata":{"id":"sThVyLCs6442","executionInfo":{"status":"ok","timestamp":1607476955635,"user_tz":480,"elapsed":335,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["data = df.copy()"],"execution_count":116,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"r-UI_Pz29G5p","executionInfo":{"status":"ok","timestamp":1607476956840,"user_tz":480,"elapsed":551,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"550e649d-275d-4fca-c4bd-8f6f8ef1ffb1"},"source":["data['labels'].value_counts()"],"execution_count":117,"outputs":[{"output_type":"execute_result","data":{"text/plain":["1    15603\n","0    13628\n","2     9845\n","Name: labels, dtype: int64"]},"metadata":{"tags":[]},"execution_count":117}]},{"cell_type":"code","metadata":{"id":"BJIQ5NY3Qoey","executionInfo":{"status":"ok","timestamp":1607564183887,"user_tz":480,"elapsed":764,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["data = Airline"],"execution_count":9,"outputs":[]},{"cell_type":"code","metadata":{"id":"OulzJYUqO9TI","executionInfo":{"status":"ok","timestamp":1607564185338,"user_tz":480,"elapsed":518,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["from sklearn.model_selection import train_test_split\n","\n","X = data.context.values\n","y = data.labels.values\n","y = y.astype(float)\n","\n","X_train, X_val, y_train, y_val =\\\n","    train_test_split(X, y, test_size=0.1, random_state=2020)"],"execution_count":10,"outputs":[]},{"cell_type":"code","metadata":{"id":"zHw-uKCPAJkd","colab":{"resources":{"http://localhost:8080/nbextensions/google.colab/files.js":{"data":"Ly8gQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQwovLwovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgovLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKLy8KLy8gICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKLy8KLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQovLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAovLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KLy8gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAovLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCi8qKgogKiBAZmlsZW92ZXJ2aWV3IEhlbHBlcnMgZm9yIGdvb2dsZS5jb2xhYiBQeXRob24gbW9kdWxlLgogKi8KKGZ1bmN0aW9uKHNjb3BlKSB7CmZ1bmN0aW9uIHNwYW4odGV4dCwgc3R5bGVBdHRyaWJ1dGVzID0ge30pIHsKICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogIGVsZW1lbnQudGV4dENvbnRlbnQgPSB0ZXh0OwogIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHN0eWxlQXR0cmlidXRlcykpIHsKICAgIGVsZW1lbnQuc3R5bGVba2V5XSA9IHN0eWxlQXR0cmlidXRlc1trZXldOwogIH0KICByZXR1cm4gZWxlbWVudDsKfQoKLy8gTWF4IG51bWJlciBvZiBieXRlcyB3aGljaCB3aWxsIGJlIHVwbG9hZGVkIGF0IGEgdGltZS4KY29uc3QgTUFYX1BBWUxPQURfU0laRSA9IDEwMCAqIDEwMjQ7CgpmdW5jdGlvbiBfdXBsb2FkRmlsZXMoaW5wdXRJZCwgb3V0cHV0SWQpIHsKICBjb25zdCBzdGVwcyA9IHVwbG9hZEZpbGVzU3RlcChpbnB1dElkLCBvdXRwdXRJZCk7CiAgY29uc3Qgb3V0cHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG91dHB1dElkKTsKICAvLyBDYWNoZSBzdGVwcyBvbiB0aGUgb3V0cHV0RWxlbWVudCB0byBtYWtlIGl0IGF2YWlsYWJsZSBmb3IgdGhlIG5leHQgY2FsbAogIC8vIHRvIHVwbG9hZEZpbGVzQ29udGludWUgZnJvbSBQeXRob24uCiAgb3V0cHV0RWxlbWVudC5zdGVwcyA9IHN0ZXBzOwoKICByZXR1cm4gX3VwbG9hZEZpbGVzQ29udGludWUob3V0cHV0SWQpOwp9CgovLyBUaGlzIGlzIHJvdWdobHkgYW4gYXN5bmMgZ2VuZXJhdG9yIChub3Qgc3VwcG9ydGVkIGluIHRoZSBicm93c2VyIHlldCksCi8vIHdoZXJlIHRoZXJlIGFyZSBtdWx0aXBsZSBhc3luY2hyb25vdXMgc3RlcHMgYW5kIHRoZSBQeXRob24gc2lkZSBpcyBnb2luZwovLyB0byBwb2xsIGZvciBjb21wbGV0aW9uIG9mIGVhY2ggc3RlcC4KLy8gVGhpcyB1c2VzIGEgUHJvbWlzZSB0byBibG9jayB0aGUgcHl0aG9uIHNpZGUgb24gY29tcGxldGlvbiBvZiBlYWNoIHN0ZXAsCi8vIHRoZW4gcGFzc2VzIHRoZSByZXN1bHQgb2YgdGhlIHByZXZpb3VzIHN0ZXAgYXMgdGhlIGlucHV0IHRvIHRoZSBuZXh0IHN0ZXAuCmZ1bmN0aW9uIF91cGxvYWRGaWxlc0NvbnRpbnVlKG91dHB1dElkKSB7CiAgY29uc3Qgb3V0cHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG91dHB1dElkKTsKICBjb25zdCBzdGVwcyA9IG91dHB1dEVsZW1lbnQuc3RlcHM7CgogIGNvbnN0IG5leHQgPSBzdGVwcy5uZXh0KG91dHB1dEVsZW1lbnQubGFzdFByb21pc2VWYWx1ZSk7CiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXh0LnZhbHVlLnByb21pc2UpLnRoZW4oKHZhbHVlKSA9PiB7CiAgICAvLyBDYWNoZSB0aGUgbGFzdCBwcm9taXNlIHZhbHVlIHRvIG1ha2UgaXQgYXZhaWxhYmxlIHRvIHRoZSBuZXh0CiAgICAvLyBzdGVwIG9mIHRoZSBnZW5lcmF0b3IuCiAgICBvdXRwdXRFbGVtZW50Lmxhc3RQcm9taXNlVmFsdWUgPSB2YWx1ZTsKICAgIHJldHVybiBuZXh0LnZhbHVlLnJlc3BvbnNlOwogIH0pOwp9CgovKioKICogR2VuZXJhdG9yIGZ1bmN0aW9uIHdoaWNoIGlzIGNhbGxlZCBiZXR3ZWVuIGVhY2ggYXN5bmMgc3RlcCBvZiB0aGUgdXBsb2FkCiAqIHByb2Nlc3MuCiAqIEBwYXJhbSB7c3RyaW5nfSBpbnB1dElkIEVsZW1lbnQgSUQgb2YgdGhlIGlucHV0IGZpbGUgcGlja2VyIGVsZW1lbnQuCiAqIEBwYXJhbSB7c3RyaW5nfSBvdXRwdXRJZCBFbGVtZW50IElEIG9mIHRoZSBvdXRwdXQgZGlzcGxheS4KICogQHJldHVybiB7IUl0ZXJhYmxlPCFPYmplY3Q+fSBJdGVyYWJsZSBvZiBuZXh0IHN0ZXBzLgogKi8KZnVuY3Rpb24qIHVwbG9hZEZpbGVzU3RlcChpbnB1dElkLCBvdXRwdXRJZCkgewogIGNvbnN0IGlucHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlucHV0SWQpOwogIGlucHV0RWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlOwoKICBjb25zdCBvdXRwdXRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3V0cHV0SWQpOwogIG91dHB1dEVsZW1lbnQuaW5uZXJIVE1MID0gJyc7CgogIGNvbnN0IHBpY2tlZFByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7CiAgICAgIHJlc29sdmUoZS50YXJnZXQuZmlsZXMpOwogICAgfSk7CiAgfSk7CgogIGNvbnN0IGNhbmNlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogIGlucHV0RWxlbWVudC5wYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKGNhbmNlbCk7CiAgY2FuY2VsLnRleHRDb250ZW50ID0gJ0NhbmNlbCB1cGxvYWQnOwogIGNvbnN0IGNhbmNlbFByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgY2FuY2VsLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgIHJlc29sdmUobnVsbCk7CiAgICB9OwogIH0pOwoKICAvLyBXYWl0IGZvciB0aGUgdXNlciB0byBwaWNrIHRoZSBmaWxlcy4KICBjb25zdCBmaWxlcyA9IHlpZWxkIHsKICAgIHByb21pc2U6IFByb21pc2UucmFjZShbcGlja2VkUHJvbWlzZSwgY2FuY2VsUHJvbWlzZV0pLAogICAgcmVzcG9uc2U6IHsKICAgICAgYWN0aW9uOiAnc3RhcnRpbmcnLAogICAgfQogIH07CgogIGNhbmNlbC5yZW1vdmUoKTsKCiAgLy8gRGlzYWJsZSB0aGUgaW5wdXQgZWxlbWVudCBzaW5jZSBmdXJ0aGVyIHBpY2tzIGFyZSBub3QgYWxsb3dlZC4KICBpbnB1dEVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlOwoKICBpZiAoIWZpbGVzKSB7CiAgICByZXR1cm4gewogICAgICByZXNwb25zZTogewogICAgICAgIGFjdGlvbjogJ2NvbXBsZXRlJywKICAgICAgfQogICAgfTsKICB9CgogIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykgewogICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpOwogICAgbGkuYXBwZW5kKHNwYW4oZmlsZS5uYW1lLCB7Zm9udFdlaWdodDogJ2JvbGQnfSkpOwogICAgbGkuYXBwZW5kKHNwYW4oCiAgICAgICAgYCgke2ZpbGUudHlwZSB8fCAnbi9hJ30pIC0gJHtmaWxlLnNpemV9IGJ5dGVzLCBgICsKICAgICAgICBgbGFzdCBtb2RpZmllZDogJHsKICAgICAgICAgICAgZmlsZS5sYXN0TW9kaWZpZWREYXRlID8gZmlsZS5sYXN0TW9kaWZpZWREYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygpIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ24vYSd9IC0gYCkpOwogICAgY29uc3QgcGVyY2VudCA9IHNwYW4oJzAlIGRvbmUnKTsKICAgIGxpLmFwcGVuZENoaWxkKHBlcmNlbnQpOwoKICAgIG91dHB1dEVsZW1lbnQuYXBwZW5kQ2hpbGQobGkpOwoKICAgIGNvbnN0IGZpbGVEYXRhUHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZSkgPT4gewogICAgICAgIHJlc29sdmUoZS50YXJnZXQucmVzdWx0KTsKICAgICAgfTsKICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGUpOwogICAgfSk7CiAgICAvLyBXYWl0IGZvciB0aGUgZGF0YSB0byBiZSByZWFkeS4KICAgIGxldCBmaWxlRGF0YSA9IHlpZWxkIHsKICAgICAgcHJvbWlzZTogZmlsZURhdGFQcm9taXNlLAogICAgICByZXNwb25zZTogewogICAgICAgIGFjdGlvbjogJ2NvbnRpbnVlJywKICAgICAgfQogICAgfTsKCiAgICAvLyBVc2UgYSBjaHVua2VkIHNlbmRpbmcgdG8gYXZvaWQgbWVzc2FnZSBzaXplIGxpbWl0cy4gU2VlIGIvNjIxMTU2NjAuCiAgICBsZXQgcG9zaXRpb24gPSAwOwogICAgd2hpbGUgKHBvc2l0aW9uIDwgZmlsZURhdGEuYnl0ZUxlbmd0aCkgewogICAgICBjb25zdCBsZW5ndGggPSBNYXRoLm1pbihmaWxlRGF0YS5ieXRlTGVuZ3RoIC0gcG9zaXRpb24sIE1BWF9QQVlMT0FEX1NJWkUpOwogICAgICBjb25zdCBjaHVuayA9IG5ldyBVaW50OEFycmF5KGZpbGVEYXRhLCBwb3NpdGlvbiwgbGVuZ3RoKTsKICAgICAgcG9zaXRpb24gKz0gbGVuZ3RoOwoKICAgICAgY29uc3QgYmFzZTY0ID0gYnRvYShTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGNodW5rKSk7CiAgICAgIHlpZWxkIHsKICAgICAgICByZXNwb25zZTogewogICAgICAgICAgYWN0aW9uOiAnYXBwZW5kJywKICAgICAgICAgIGZpbGU6IGZpbGUubmFtZSwKICAgICAgICAgIGRhdGE6IGJhc2U2NCwKICAgICAgICB9LAogICAgICB9OwogICAgICBwZXJjZW50LnRleHRDb250ZW50ID0KICAgICAgICAgIGAke01hdGgucm91bmQoKHBvc2l0aW9uIC8gZmlsZURhdGEuYnl0ZUxlbmd0aCkgKiAxMDApfSUgZG9uZWA7CiAgICB9CiAgfQoKICAvLyBBbGwgZG9uZS4KICB5aWVsZCB7CiAgICByZXNwb25zZTogewogICAgICBhY3Rpb246ICdjb21wbGV0ZScsCiAgICB9CiAgfTsKfQoKc2NvcGUuZ29vZ2xlID0gc2NvcGUuZ29vZ2xlIHx8IHt9OwpzY29wZS5nb29nbGUuY29sYWIgPSBzY29wZS5nb29nbGUuY29sYWIgfHwge307CnNjb3BlLmdvb2dsZS5jb2xhYi5fZmlsZXMgPSB7CiAgX3VwbG9hZEZpbGVzLAogIF91cGxvYWRGaWxlc0NvbnRpbnVlLAp9Owp9KShzZWxmKTsK","ok":true,"headers":[["content-type","application/javascript"]],"status":200,"status_text":""}},"base_uri":"https://localhost:8080/","height":75},"executionInfo":{"status":"ok","timestamp":1607378572636,"user_tz":300,"elapsed":140304,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"7335bc2d-2fcb-48e2-dd13-978f73ef12db"},"source":["from google.colab import files\n","uploaded = files.upload()"],"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["\n","     <input type=\"file\" id=\"files-effba015-d889-4a09-bac7-196765ec903a\" name=\"files[]\" multiple disabled\n","        style=\"border:none\" />\n","     <output id=\"result-effba015-d889-4a09-bac7-196765ec903a\">\n","      Upload widget is only available when the cell has been executed in the\n","      current browser session. Please rerun this cell to enable.\n","      </output>\n","      <script src=\"/nbextensions/google.colab/files.js\"></script> "],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["Saving Total_12-2-20.csv to Total_12-2-20.csv\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"_JWXnfBlwyWC"},"source":["test_data = pd.read_csv('Total_12-2-20.csv')"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"nmhkvfTmAnxl","colab":{"base_uri":"https://localhost:8080/","height":477},"executionInfo":{"status":"ok","timestamp":1607378575514,"user_tz":300,"elapsed":630,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"e47566c5-8d5f-475a-ce25-384aa610054c"},"source":["test_data.head(5)"],"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>status_id</th>\n","      <th>time_retrieved</th>\n","      <th>text</th>\n","      <th>created_at</th>\n","      <th>favorite_count</th>\n","      <th>retweet_count</th>\n","      <th>place</th>\n","      <th>coordinates</th>\n","      <th>user_id</th>\n","      <th>screen_name</th>\n","      <th>user_description</th>\n","      <th>user_follower_count</th>\n","      <th>verified</th>\n","      <th>user_location</th>\n","      <th>City</th>\n","      <th>State</th>\n","      <th>Country</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1327298633683791872</td>\n","      <td>2020-11-16  21:14</td>\n","      <td>Facts: \\r\\n\\r\\nChernobyl doesn't prove that nu...</td>\n","      <td>2020-11-13 17:13:48</td>\n","      <td>348.0</td>\n","      <td>74.0</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>4.116028e+07</td>\n","      <td>prageru</td>\n","      <td>Free Videos. Free Minds.</td>\n","      <td>563593.0</td>\n","      <td>True</td>\n","      <td>los angeles</td>\n","      <td>los angeles</td>\n","      <td>ca</td>\n","      <td>USA</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>1328517972026159104</td>\n","      <td>2020-11-16  21:14</td>\n","      <td>Microreactors are the smallest class of nuclea...</td>\n","      <td>2020-11-17 01:59:01</td>\n","      <td>20.0</td>\n","      <td>6.0</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>1.100064e+18</td>\n","      <td>GovNuclear</td>\n","      <td>Making nuclear cool again 😎. Advancing new tec...</td>\n","      <td>12137.0</td>\n","      <td>True</td>\n","      <td>washington, dc</td>\n","      <td>dc</td>\n","      <td>md</td>\n","      <td>USA</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>1328409437757968385</td>\n","      <td>2020-11-16  21:14</td>\n","      <td>Nice resource on global nuclear energy statist...</td>\n","      <td>2020-11-16 18:47:45</td>\n","      <td>3.0</td>\n","      <td>1.0</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>1.100064e+18</td>\n","      <td>GovNuclear</td>\n","      <td>Making nuclear cool again 😎. Advancing new tec...</td>\n","      <td>12137.0</td>\n","      <td>True</td>\n","      <td>washington, dc</td>\n","      <td>dc</td>\n","      <td>md</td>\n","      <td>USA</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>1328407132925026311</td>\n","      <td>2020-11-16  21:14</td>\n","      <td>Excited to see @ENERGY and @NASA's strong part...</td>\n","      <td>2020-11-16 18:38:35</td>\n","      <td>0.0</td>\n","      <td>15.0</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>1.100064e+18</td>\n","      <td>GovNuclear</td>\n","      <td>Making nuclear cool again 😎. Advancing new tec...</td>\n","      <td>12137.0</td>\n","      <td>True</td>\n","      <td>washington, dc</td>\n","      <td>dc</td>\n","      <td>md</td>\n","      <td>USA</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>1328367476908896260</td>\n","      <td>2020-11-16  21:14</td>\n","      <td>VIRTUAL EVENT: @ENERGY and industry experts di...</td>\n","      <td>2020-11-16 16:01:01</td>\n","      <td>11.0</td>\n","      <td>4.0</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>1.100064e+18</td>\n","      <td>GovNuclear</td>\n","      <td>Making nuclear cool again 😎. Advancing new tec...</td>\n","      <td>12137.0</td>\n","      <td>True</td>\n","      <td>washington, dc</td>\n","      <td>dc</td>\n","      <td>md</td>\n","      <td>USA</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["             status_id     time_retrieved  ... State Country\n","0  1327298633683791872  2020-11-16  21:14  ...    ca     USA\n","1  1328517972026159104  2020-11-16  21:14  ...    md     USA\n","2  1328409437757968385  2020-11-16  21:14  ...    md     USA\n","3  1328407132925026311  2020-11-16  21:14  ...    md     USA\n","4  1328367476908896260  2020-11-16  21:14  ...    md     USA\n","\n","[5 rows x 17 columns]"]},"metadata":{"tags":[]},"execution_count":23}]},{"cell_type":"code","metadata":{"id":"K7hxtI4l0SUJ","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607564192137,"user_tz":480,"elapsed":2581,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"3dfe28ee-26b1-4074-f8c2-cb4b90d5ec53"},"source":["import torch\n","\n","if torch.cuda.is_available():       \n","    device = torch.device(\"cuda\")\n","    print(f'There are {torch.cuda.device_count()} GPU(s) available.')\n","    print('Device name:', torch.cuda.get_device_name(0))\n","\n","else:\n","    print('No GPU available, using the CPU instead.')\n","    device = torch.device(\"cpu\")"],"execution_count":11,"outputs":[{"output_type":"stream","text":["There are 1 GPU(s) available.\n","Device name: Tesla V100-SXM2-16GB\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"uFiv8WGl4p40","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607564201612,"user_tz":480,"elapsed":10316,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"f81e0f21-bc28-4be6-bad9-dbafe29f702e"},"source":["!pip install transformers==2.8.0"],"execution_count":12,"outputs":[{"output_type":"stream","text":["Collecting transformers==2.8.0\n","\u001b[?25l  Downloading https://files.pythonhosted.org/packages/a3/78/92cedda05552398352ed9784908b834ee32a0bd071a9b32de287327370b7/transformers-2.8.0-py3-none-any.whl (563kB)\n","\r\u001b[K     |▋                               | 10kB 21.6MB/s eta 0:00:01\r\u001b[K     |█▏                              | 20kB 28.0MB/s eta 0:00:01\r\u001b[K     |█▊                              | 30kB 33.1MB/s eta 0:00:01\r\u001b[K     |██▎                             | 40kB 21.7MB/s eta 0:00:01\r\u001b[K     |███                             | 51kB 17.2MB/s eta 0:00:01\r\u001b[K     |███▌                            | 61kB 15.8MB/s eta 0:00:01\r\u001b[K     |████                            | 71kB 13.0MB/s eta 0:00:01\r\u001b[K     |████▋                           | 81kB 13.6MB/s eta 0:00:01\r\u001b[K     |█████▎                          | 92kB 13.4MB/s eta 0:00:01\r\u001b[K     |█████▉                          | 102kB 13.3MB/s eta 0:00:01\r\u001b[K     |██████▍                         | 112kB 13.3MB/s eta 0:00:01\r\u001b[K     |███████                         | 122kB 13.3MB/s eta 0:00:01\r\u001b[K     |███████▋                        | 133kB 13.3MB/s eta 0:00:01\r\u001b[K     |████████▏                       | 143kB 13.3MB/s eta 0:00:01\r\u001b[K     |████████▊                       | 153kB 13.3MB/s eta 0:00:01\r\u001b[K     |█████████▎                      | 163kB 13.3MB/s eta 0:00:01\r\u001b[K     |█████████▉                      | 174kB 13.3MB/s eta 0:00:01\r\u001b[K     |██████████▌                     | 184kB 13.3MB/s eta 0:00:01\r\u001b[K     |███████████                     | 194kB 13.3MB/s eta 0:00:01\r\u001b[K     |███████████▋                    | 204kB 13.3MB/s eta 0:00:01\r\u001b[K     |████████████▏                   | 215kB 13.3MB/s eta 0:00:01\r\u001b[K     |████████████▉                   | 225kB 13.3MB/s eta 0:00:01\r\u001b[K     |█████████████▍                  | 235kB 13.3MB/s eta 0:00:01\r\u001b[K     |██████████████                  | 245kB 13.3MB/s eta 0:00:01\r\u001b[K     |██████████████▌                 | 256kB 13.3MB/s eta 0:00:01\r\u001b[K     |███████████████▏                | 266kB 13.3MB/s eta 0:00:01\r\u001b[K     |███████████████▊                | 276kB 13.3MB/s eta 0:00:01\r\u001b[K     |████████████████▎               | 286kB 13.3MB/s eta 0:00:01\r\u001b[K     |████████████████▉               | 296kB 13.3MB/s eta 0:00:01\r\u001b[K     |█████████████████▍              | 307kB 13.3MB/s eta 0:00:01\r\u001b[K     |██████████████████              | 317kB 13.3MB/s eta 0:00:01\r\u001b[K     |██████████████████▋             | 327kB 13.3MB/s eta 0:00:01\r\u001b[K     |███████████████████▏            | 337kB 13.3MB/s eta 0:00:01\r\u001b[K     |███████████████████▊            | 348kB 13.3MB/s eta 0:00:01\r\u001b[K     |████████████████████▍           | 358kB 13.3MB/s eta 0:00:01\r\u001b[K     |█████████████████████           | 368kB 13.3MB/s eta 0:00:01\r\u001b[K     |█████████████████████▌          | 378kB 13.3MB/s eta 0:00:01\r\u001b[K     |██████████████████████          | 389kB 13.3MB/s eta 0:00:01\r\u001b[K     |██████████████████████▊         | 399kB 13.3MB/s eta 0:00:01\r\u001b[K     |███████████████████████▎        | 409kB 13.3MB/s eta 0:00:01\r\u001b[K     |███████████████████████▉        | 419kB 13.3MB/s eta 0:00:01\r\u001b[K     |████████████████████████▍       | 430kB 13.3MB/s eta 0:00:01\r\u001b[K     |█████████████████████████       | 440kB 13.3MB/s eta 0:00:01\r\u001b[K     |█████████████████████████▋      | 450kB 13.3MB/s eta 0:00:01\r\u001b[K     |██████████████████████████▏     | 460kB 13.3MB/s eta 0:00:01\r\u001b[K     |██████████████████████████▊     | 471kB 13.3MB/s eta 0:00:01\r\u001b[K     |███████████████████████████▎    | 481kB 13.3MB/s eta 0:00:01\r\u001b[K     |████████████████████████████    | 491kB 13.3MB/s eta 0:00:01\r\u001b[K     |████████████████████████████▌   | 501kB 13.3MB/s eta 0:00:01\r\u001b[K     |█████████████████████████████   | 512kB 13.3MB/s eta 0:00:01\r\u001b[K     |█████████████████████████████▋  | 522kB 13.3MB/s eta 0:00:01\r\u001b[K     |██████████████████████████████▎ | 532kB 13.3MB/s eta 0:00:01\r\u001b[K     |██████████████████████████████▉ | 542kB 13.3MB/s eta 0:00:01\r\u001b[K     |███████████████████████████████▍| 552kB 13.3MB/s eta 0:00:01\r\u001b[K     |████████████████████████████████| 563kB 13.3MB/s eta 0:00:01\r\u001b[K     |████████████████████████████████| 573kB 13.3MB/s \n","\u001b[?25hRequirement already satisfied: requests in /usr/local/lib/python3.6/dist-packages (from transformers==2.8.0) (2.23.0)\n","Collecting tokenizers==0.5.2\n","\u001b[?25l  Downloading https://files.pythonhosted.org/packages/d1/3f/73c881ea4723e43c1e9acf317cf407fab3a278daab3a69c98dcac511c04f/tokenizers-0.5.2-cp36-cp36m-manylinux1_x86_64.whl (3.7MB)\n","\u001b[K     |████████████████████████████████| 3.7MB 13.5MB/s \n","\u001b[?25hRequirement already satisfied: filelock in /usr/local/lib/python3.6/dist-packages (from transformers==2.8.0) (3.0.12)\n","Collecting sacremoses\n","\u001b[?25l  Downloading https://files.pythonhosted.org/packages/7d/34/09d19aff26edcc8eb2a01bed8e98f13a1537005d31e95233fd48216eed10/sacremoses-0.0.43.tar.gz (883kB)\n","\u001b[K     |████████████████████████████████| 890kB 57.9MB/s \n","\u001b[?25hRequirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.6/dist-packages (from transformers==2.8.0) (2019.12.20)\n","Requirement already satisfied: tqdm>=4.27 in /usr/local/lib/python3.6/dist-packages (from transformers==2.8.0) (4.41.1)\n","Collecting boto3\n","\u001b[?25l  Downloading https://files.pythonhosted.org/packages/00/65/a573dd1cc6ca76815f358f9e5be449221f4017a87b2e6b5ea970df28f94b/boto3-1.16.33-py2.py3-none-any.whl (129kB)\n","\u001b[K     |████████████████████████████████| 133kB 55.0MB/s \n","\u001b[?25hCollecting sentencepiece\n","\u001b[?25l  Downloading https://files.pythonhosted.org/packages/e5/2d/6d4ca4bef9a67070fa1cac508606328329152b1df10bdf31fb6e4e727894/sentencepiece-0.1.94-cp36-cp36m-manylinux2014_x86_64.whl (1.1MB)\n","\u001b[K     |████████████████████████████████| 1.1MB 52.1MB/s \n","\u001b[?25hRequirement already satisfied: numpy in /usr/local/lib/python3.6/dist-packages (from transformers==2.8.0) (1.18.5)\n","Requirement already satisfied: dataclasses; python_version < \"3.7\" in /usr/local/lib/python3.6/dist-packages (from transformers==2.8.0) (0.8)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.6/dist-packages (from requests->transformers==2.8.0) (3.0.4)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.6/dist-packages (from requests->transformers==2.8.0) (2.10)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.6/dist-packages (from requests->transformers==2.8.0) (2020.11.8)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.6/dist-packages (from requests->transformers==2.8.0) (1.24.3)\n","Requirement already satisfied: six in /usr/local/lib/python3.6/dist-packages (from sacremoses->transformers==2.8.0) (1.15.0)\n","Requirement already satisfied: click in /usr/local/lib/python3.6/dist-packages (from sacremoses->transformers==2.8.0) (7.1.2)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.6/dist-packages (from sacremoses->transformers==2.8.0) (0.17.0)\n","Collecting jmespath<1.0.0,>=0.7.1\n","  Downloading https://files.pythonhosted.org/packages/07/cb/5f001272b6faeb23c1c9e0acc04d48eaaf5c862c17709d20e3469c6e0139/jmespath-0.10.0-py2.py3-none-any.whl\n","Collecting botocore<1.20.0,>=1.19.33\n","\u001b[?25l  Downloading https://files.pythonhosted.org/packages/76/3e/5f64c7b492312069520d219ed56ce6b3d1821dab8251c18d25728578b58e/botocore-1.19.33-py2.py3-none-any.whl (7.0MB)\n","\u001b[K     |████████████████████████████████| 7.0MB 60.4MB/s \n","\u001b[?25hCollecting s3transfer<0.4.0,>=0.3.0\n","\u001b[?25l  Downloading https://files.pythonhosted.org/packages/69/79/e6afb3d8b0b4e96cefbdc690f741d7dd24547ff1f94240c997a26fa908d3/s3transfer-0.3.3-py2.py3-none-any.whl (69kB)\n","\u001b[K     |████████████████████████████████| 71kB 10.1MB/s \n","\u001b[?25hRequirement already satisfied: python-dateutil<3.0.0,>=2.1 in /usr/local/lib/python3.6/dist-packages (from botocore<1.20.0,>=1.19.33->boto3->transformers==2.8.0) (2.8.1)\n","Building wheels for collected packages: sacremoses\n","  Building wheel for sacremoses (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for sacremoses: filename=sacremoses-0.0.43-cp36-none-any.whl size=893257 sha256=2c547c08b411a80da95d9dc4fc554904de82d7033453108a5b432fb3001b1864\n","  Stored in directory: /root/.cache/pip/wheels/29/3c/fd/7ce5c3f0666dab31a50123635e6fb5e19ceb42ce38d4e58f45\n","Successfully built sacremoses\n","\u001b[31mERROR: botocore 1.19.33 has requirement urllib3<1.27,>=1.25.4; python_version != \"3.4\", but you'll have urllib3 1.24.3 which is incompatible.\u001b[0m\n","Installing collected packages: tokenizers, sacremoses, jmespath, botocore, s3transfer, boto3, sentencepiece, transformers\n","Successfully installed boto3-1.16.33 botocore-1.19.33 jmespath-0.10.0 s3transfer-0.3.3 sacremoses-0.0.43 sentencepiece-0.1.94 tokenizers-0.5.2 transformers-2.8.0\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"1GfN8hg19OqU","executionInfo":{"status":"ok","timestamp":1607564203260,"user_tz":480,"elapsed":9850,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["from transformers import ElectraConfig, ElectraTokenizer, ElectraModel, RobertaModel, BartModel\n","import torch"],"execution_count":13,"outputs":[]},{"cell_type":"code","metadata":{"id":"4L_Rc7l4bgzJ","executionInfo":{"status":"ok","timestamp":1607564203261,"user_tz":480,"elapsed":9275,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["def text_preprocessing(text):\n","    text = re.sub(r'(@.*?)[\\s]', ' ', text)\n","    text = re.sub(r'&amp;', '&', text)\n","    text = re.sub(r\"@[A-Za-z0-9]+\", ' ', text)\n","    text = re.sub(r\"https?://[A-Za-z0-9./]+\", ' ', text)\n","    text = re.sub(r\"[^a-zA-z.!?'0-9]\", ' ', text)\n","    text = re.sub('\\t', ' ',  text)\n","    text = re.sub(r\" +\", ' ', text)\n","    return text"],"execution_count":14,"outputs":[]},{"cell_type":"code","metadata":{"id":"qyYmHR8McE0r","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607560694670,"user_tz":480,"elapsed":5277,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"8c42d80c-1bc0-486e-f4ec-0c503716da9c"},"source":["print('Original: ', X[0])\n","print('Processed: ', text_preprocessing(X[0]))"],"execution_count":16,"outputs":[{"output_type":"stream","text":["Original:  @USAirways horrible experience to key west lost luggage called to check &amp; was told not to call back reconsidering my flight back\n","Processed:   horrible experience to key west lost luggage called to check was told not to call back reconsidering my flight back\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"yDAfbCle59tP","colab":{"base_uri":"https://localhost:8080/","height":66,"referenced_widgets":["33aa1abf123541158de12632ac6f3cab","57a4fd2ab9e04d2d82d9fde9943ebe8c","2e8f3e58b7224d01b65b98c621d72144","013b3fde6d9a47ddbe76c8c773b3db03","52a2ca9193d24052852ef24c19cb7d23","a67da284b353409d871eceb0ba9e4881","561664df800742c4b8eaa184bdeebe66","d5efa4c29da2408eaa077e9c3089c77a"]},"executionInfo":{"status":"ok","timestamp":1607564204457,"user_tz":480,"elapsed":8424,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"1b207680-9fd7-4a9f-f1f1-febc09cdb395"},"source":["from transformers import ElectraTokenizer\n","from transformers import RobertaTokenizer\n","from transformers import XLNetTokenizer\n","from transformers import BertTokenizer\n","#tokenizer = RobertaTokenizer.from_pretrained('roberta-base')\n","tokenizer = ElectraTokenizer.from_pretrained('google/electra-small-discriminator') \n","#tokenizer = ElectraTokenizer.from_pretrained(''xlnet-base')\n","\n","\n","\n","\n","def preprocessing_for_bert(data):\n","    input_ids = []\n","    attention_masks = []\n","\n","    for sent in data:\n","\n","        encoded_sent = tokenizer.encode_plus(\n","            text=text_preprocessing(sent),  \n","            add_special_tokens=True,        \n","            max_length=MAX_LEN,                  \n","            pad_to_max_length=True,         \n","            #return_tensors='pt',           \n","            return_attention_mask=True      \n","            )\n","        \n","        input_ids.append(encoded_sent.get('input_ids'))\n","        attention_masks.append(encoded_sent.get('attention_mask'))\n","    input_ids = torch.tensor(input_ids)\n","    attention_masks = torch.tensor(attention_masks)\n","\n","    return input_ids, attention_masks"],"execution_count":15,"outputs":[{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"33aa1abf123541158de12632ac6f3cab","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=231508.0, style=ProgressStyle(descripti…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"hrbvKGNAlMtt","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607564206046,"user_tz":480,"elapsed":2861,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"b586c58c-a5e5-4300-b4ca-66e45e4a71d9"},"source":["all_tweets = data.context.values\n","encoded_tweets = [tokenizer.encode(sent, add_special_tokens=True) for sent in all_tweets]\n","max_len = max([len(sent) for sent in encoded_tweets])\n","print('Max length: ', max_len)"],"execution_count":16,"outputs":[{"output_type":"stream","text":["Max length:  62\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"QTlQzTzAfCy7","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607564207465,"user_tz":480,"elapsed":2276,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"d15d7ad0-6861-4a88-cc6c-cb812bc42b1f"},"source":["import torch\n","MAX_LEN =67\n","token_ids = list(preprocessing_for_bert([X[0]])[0].squeeze().numpy())\n","print('Original: ', X[0])\n","print('Token IDs: ', token_ids)\n","print('Tokenizing data...')\n","train_inputs, train_masks = preprocessing_for_bert(X_train)\n","val_inputs, val_masks = preprocessing_for_bert(X_val)"],"execution_count":17,"outputs":[{"output_type":"stream","text":["Original:  @AmericanAir this might look good but the pita is inedible. Last year delicious shrimp cocktail. This year garbage http://t.co/Sotl8XQsrp\n","Token IDs:  [101, 2023, 2453, 2298, 2204, 2021, 1996, 6770, 2050, 2003, 1999, 2098, 7028, 1012, 2197, 2095, 12090, 20130, 18901, 1012, 2023, 2095, 13044, 102, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n","Tokenizing data...\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"xHuYEc61gcGL","executionInfo":{"status":"ok","timestamp":1607564507126,"user_tz":480,"elapsed":555,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["from torch.utils.data import TensorDataset, DataLoader, RandomSampler, SequentialSampler\n","train_labels = torch.tensor(y_train)\n","val_labels = torch.tensor(y_val)\n","batch_size = 8\n","train_data = TensorDataset(train_inputs, train_masks, train_labels)\n","train_sampler = RandomSampler(train_data)\n","train_dataloader = DataLoader(train_data, sampler=train_sampler, batch_size=batch_size)\n","val_data = TensorDataset(val_inputs, val_masks, val_labels)\n","val_sampler = SequentialSampler(val_data)\n","val_dataloader = DataLoader(val_data, sampler=val_sampler, batch_size=batch_size)"],"execution_count":48,"outputs":[]},{"cell_type":"code","metadata":{"id":"YK41aBFSj5jK","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607564216623,"user_tz":480,"elapsed":504,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"5be4229d-22fe-4c17-aea3-baf38177d439"},"source":["%%time\n","import torch\n","import torch.nn as nn\n","#from transformers import BartModel\n","#BartModel.from_pretrained('facebook/bart-large')\n","#ElectraModel.from_pretrained('google/electra-large-discriminator')\n","class BertClassifier(nn.Module):\n","    \"\"\"Bert Model for Classification Tasks.\n","    \"\"\"\n","    def __init__(self, freeze_bert=False):\n","\n","        super(BertClassifier, self).__init__()\n","        D_in, H, D_out = 256, 64, 3\n","        self.bert = ElectraModel.from_pretrained('google/electra-small-discriminator')\n","        self.classifier = nn.Sequential(\n","            nn.Linear(D_in, H),\n","            nn.ReLU(),\n","            #nn.Dropout(0.1),\n","            nn.Linear(H, D_out)\n","        )\n","        #if freeze_bert:\n","            #for param in self.bert.parameters():\n","                #param.requires_grad = False\n","        \n","    def forward(self, input_ids, attention_mask):\n","        outputs = self.bert(input_ids=input_ids, attention_mask=attention_mask)\n","        last_hidden_state_cls = outputs[0][:, 0, :]\n","        logits = self.classifier(last_hidden_state_cls)\n","        return logits"],"execution_count":19,"outputs":[{"output_type":"stream","text":["CPU times: user 40 µs, sys: 0 ns, total: 40 µs\n","Wall time: 42.2 µs\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"3PqDB2n48qxB"},"source":["model = ElectraModel.from_pretrained('google/electra-large-discriminator')\n","model"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"JX7su7Q_269U","executionInfo":{"status":"ok","timestamp":1607564223504,"user_tz":480,"elapsed":856,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["from transformers import AdamW, get_linear_schedule_with_warmup\n","\n","def initialize_model(epochs=4):\n","    bert_classifier = BertClassifier(freeze_bert=False)\n","    bert_classifier.to(device)\n","    optimizer = AdamW(bert_classifier.parameters(),\n","                      lr=1e-5,    \n","                      eps=1e-6    \n","                      )\n","    total_steps = len(train_dataloader) * epochs\n","    scheduler = get_linear_schedule_with_warmup(optimizer,\n","                                                num_warmup_steps=1000, \n","                                                num_training_steps=total_steps)\n","    return bert_classifier, optimizer, scheduler"],"execution_count":20,"outputs":[]},{"cell_type":"code","metadata":{"id":"Xy4HkhyECibW","executionInfo":{"status":"ok","timestamp":1607564225189,"user_tz":480,"elapsed":634,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["import random\n","import time\n","loss_fn = nn.CrossEntropyLoss()\n","def set_seed(seed_value=42):\n","    \"\"\"Set seed for reproducibility.\n","    \"\"\"\n","    random.seed(seed_value)\n","    np.random.seed(seed_value)\n","    torch.manual_seed(seed_value)\n","    torch.cuda.manual_seed_all(seed_value)\n","\n","def train(model, train_dataloader, val_dataloader=None, epochs=4, evaluation=False):\n","\n","    for epoch_i in range(epochs):\n","        print(f\"{'Epoch':^7} | {'Batch':^7} | {'Train Loss':^12} | {'Val Loss':^10} | {'Val Acc':^9} | {'Elapsed':^9}\")\n","        print(\"-\"*70)\n","        t0_epoch, t0_batch = time.time(), time.time()\n","        total_loss, batch_loss, batch_counts = 0, 0, 0\n","        model.train()\n","        for step, batch in enumerate(train_dataloader):\n","            batch_counts +=1\n","            b_input_ids, b_attn_mask, b_labels = tuple(t.to(device) for t in batch)\n","            model.zero_grad()\n","            logits = model(b_input_ids, b_attn_mask)\n","            loss = loss_fn(logits, b_labels.long())\n","            batch_loss += loss.item()\n","            total_loss += loss.item()\n","            loss.backward()\n","            torch.nn.utils.clip_grad_norm_(model.parameters(), 1.0)\n","            optimizer.step()\n","            scheduler.step()\n","            if (step % 20 == 0 and step != 0) or (step == len(train_dataloader) - 1):\n","                time_elapsed = time.time() - t0_batch\n","                print(f\"{epoch_i + 1:^7} | {step:^7} | {batch_loss / batch_counts:^12.6f} | {'-':^10} | {'-':^9} | {time_elapsed:^9.2f}\")\n","                batch_loss, batch_counts = 0, 0\n","                t0_batch = time.time()\n","        avg_train_loss = total_loss / len(train_dataloader) * 6\n","        print(\"-\"*70)\n","        # =======================================\n","        #               Evaluation\n","        # =======================================\n","        if (evaluation == True):\n","          val_loss, val_accuracy = evaluate(model, val_dataloader)\n","          time_elapsed = time.time() - t0_epoch           \n","          print(f\"{epoch_i + 1:^7} | {'-':^7} | {avg_train_loss:^12.6f} | {val_loss:^10.6f} | {val_accuracy:^9.2f} | {time_elapsed:^9.2f}\")\n","          print(\"-\"*70)\n","        print(\"\\n\")\n","    \n","    print(\"Training complete!\")\n","\n","\n","def evaluate(model, val_dataloader):\n","    model.eval()\n","    val_accuracy = []\n","    val_loss = []\n","    for batch in val_dataloader:\n","        b_input_ids, b_attn_mask, b_labels = tuple(t.to(device) for t in batch)\n","        with torch.no_grad():\n","            logits = model(b_input_ids, b_attn_mask)\n","        loss = loss_fn(logits, b_labels.long())\n","        val_loss.append(loss.item())\n","        preds = torch.argmax(logits, dim=1).flatten()\n","        accuracy = (preds == b_labels).cpu().numpy().mean() * 100\n","        val_accuracy.append(accuracy)\n","    val_loss = np.mean(val_loss)\n","    val_accuracy = np.mean(val_accuracy)\n","    return val_loss, val_accuracy"],"execution_count":21,"outputs":[]},{"cell_type":"code","metadata":{"id":"wfYw7dJ0U0v6","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607565300811,"user_tz":480,"elapsed":35848,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"b744402e-f8dc-49bd-a199-179577e0cb69"},"source":["set_seed(10)\n","bert_classifier, optimizer, scheduler = initialize_model(epochs=1)\n","train(bert_classifier, train_dataloader, val_dataloader, epochs=1, evaluation=True)"],"execution_count":68,"outputs":[{"output_type":"stream","text":[" Epoch  |  Batch  |  Train Loss  |  Val Loss  |  Val Acc  |  Elapsed \n","----------------------------------------------------------------------\n","   1    |   20    |   1.256261   |     -      |     -     |   1.73   \n","   1    |   40    |   1.276504   |     -      |     -     |   1.47   \n","   1    |   60    |   1.246965   |     -      |     -     |   1.53   \n","   1    |   80    |   1.242297   |     -      |     -     |   1.52   \n","   1    |   100   |   1.208377   |     -      |     -     |   1.58   \n","   1    |   120   |   1.197273   |     -      |     -     |   1.58   \n","   1    |   140   |   1.153329   |     -      |     -     |   1.52   \n","   1    |   160   |   1.121194   |     -      |     -     |   1.47   \n","   1    |   180   |   1.104530   |     -      |     -     |   1.53   \n","   1    |   200   |   1.086377   |     -      |     -     |   1.44   \n","   1    |   220   |   1.046726   |     -      |     -     |   1.44   \n","   1    |   240   |   0.997005   |     -      |     -     |   1.48   \n","   1    |   260   |   1.003871   |     -      |     -     |   1.49   \n","   1    |   280   |   0.993364   |     -      |     -     |   1.53   \n","   1    |   300   |   0.964142   |     -      |     -     |   1.47   \n","   1    |   320   |   0.959461   |     -      |     -     |   1.45   \n","   1    |   340   |   0.909811   |     -      |     -     |   1.48   \n","   1    |   360   |   0.909035   |     -      |     -     |   1.56   \n","   1    |   380   |   0.897518   |     -      |     -     |   1.47   \n","   1    |   400   |   0.935453   |     -      |     -     |   1.58   \n","   1    |   420   |   0.900891   |     -      |     -     |   1.47   \n","   1    |   440   |   0.887992   |     -      |     -     |   1.44   \n","   1    |   444   |   0.874230   |     -      |     -     |   0.29   \n","----------------------------------------------------------------------\n","   1    |    -    |   6.346796   |  0.850163  |   64.00   |   34.12  \n","----------------------------------------------------------------------\n","\n","\n","Training complete!\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"ZI6PpsD1VBgO","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607560894892,"user_tz":480,"elapsed":39637,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"ef2d59c6-a45c-4bc6-989e-70587eb21a21"},"source":["train(bert_classifier, train_dataloader, val_dataloader, epochs=1, evaluation=True)"],"execution_count":27,"outputs":[{"output_type":"stream","text":[" Epoch  |  Batch  |  Train Loss  |  Val Loss  |  Val Acc  |  Elapsed \n","----------------------------------------------------------------------\n","   1    |   20    |   0.978141   |     -      |     -     |   6.54   \n","   1    |   40    |   0.933041   |     -      |     -     |   6.17   \n","   1    |   60    |   0.946484   |     -      |     -     |   6.19   \n","   1    |   80    |   0.862507   |     -      |     -     |   6.18   \n","   1    |   100   |   0.744571   |     -      |     -     |   6.17   \n","   1    |   120   |   0.676393   |     -      |     -     |   6.17   \n","   1    |   122   |   0.634669   |     -      |     -     |   0.55   \n","----------------------------------------------------------------------\n","   1    |    -    |   5.125377   |  0.605982  |   71.95   |   39.14  \n","----------------------------------------------------------------------\n","\n","\n","Training complete!\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"V5_w4erqGzpe","executionInfo":{"status":"ok","timestamp":1607564292903,"user_tz":480,"elapsed":796,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["import torch.nn.functional as F\n","\n","def bert_predict(model, test_dataloader):\n","    model.eval()\n","    all_logits = []\n","    for batch in test_dataloader:\n","        b_input_ids, b_attn_mask = tuple(t.to(device) for t in batch)[:2]\n","        with torch.no_grad():\n","            logits = model(b_input_ids, b_attn_mask)\n","        all_logits.append(logits)\n","    all_logits = torch.cat(all_logits, dim=0)\n","    probs = F.softmax(all_logits, dim=1).cpu().numpy()\n","    return probs"],"execution_count":26,"outputs":[]},{"cell_type":"code","metadata":{"id":"kcmj5s0eRMUh","executionInfo":{"status":"ok","timestamp":1607465548573,"user_tz":480,"elapsed":2026,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["probs = bert_predict(bert_classifier, val_dataloader)"],"execution_count":58,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Dzi2OQ6cyvPJ","executionInfo":{"status":"ok","timestamp":1607465550738,"user_tz":480,"elapsed":767,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"d7462e16-d0f0-4e15-fc2e-a8e9cf01b6f4"},"source":["preds = np.argmax(probs, axis=1).flatten()\n","from sklearn.metrics import f1_score,accuracy_score\n","print(accuracy_score(preds,y_val))\n","print(f1_score(preds,y_val,average='micro'))\n","print(f1_score(preds,y_val,average='macro'))\n","print(f1_score(preds,y_val,average='weighted'))"],"execution_count":59,"outputs":[{"output_type":"stream","text":["0.8095909732016925\n","0.8095909732016925\n","0.8072463260382142\n","0.8105251500445764\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"lz3b_9UDOtDd","executionInfo":{"status":"ok","timestamp":1607244735020,"user_tz":300,"elapsed":571,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"82a1b8be-d237-4a85-9210-e3951ff99266"},"source":["from sklearn.metrics import confusion_matrix\n","confusion_matrix(val_labels.tolist(), preds, labels= [1,0,2])"],"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["array([[1179,  194,  229],\n","       [ 167, 1131,   23],\n","       [ 182,   26,  777]])"]},"metadata":{"tags":[]},"execution_count":130}]},{"cell_type":"code","metadata":{"id":"IAKbs9tBO283","executionInfo":{"status":"ok","timestamp":1607475555196,"user_tz":480,"elapsed":599,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["import numpy as np\n","\n","\n","def plot_confusion_matrix(cm,\n","                          target_names,\n","                          title='Confusion matrix',\n","                          cmap=None,\n","                          normalize=True):\n","    \"\"\"\n","    given a sklearn confusion matrix (cm), make a nice plot\n","\n","    Arguments\n","    ---------\n","    cm:           confusion matrix from sklearn.metrics.confusion_matrix\n","\n","    target_names: given classification classes such as [0, 1, 2]\n","                  the class names, for example: ['high', 'medium', 'low']\n","\n","    title:        the text to display at the top of the matrix\n","\n","    cmap:         the gradient of the values displayed from matplotlib.pyplot.cm\n","                  see http://matplotlib.org/examples/color/colormaps_reference.html\n","                  plt.get_cmap('jet') or plt.cm.Blues\n","\n","    normalize:    If False, plot the raw numbers\n","                  If True, plot the proportions\n","\n","    Usage\n","    -----\n","    plot_confusion_matrix(cm           = cm,                  # confusion matrix created by\n","                                                              # sklearn.metrics.confusion_matrix\n","                          normalize    = True,                # show proportions\n","                          target_names = y_labels_vals,       # list of names of the classes\n","                          title        = best_estimator_name) # title of graph\n","\n","    Citiation\n","    ---------\n","    http://scikit-learn.org/stable/auto_examples/model_selection/plot_confusion_matrix.html\n","\n","    \"\"\"\n","    import matplotlib.pyplot as plt\n","    import numpy as np\n","    import itertools\n","\n","    accuracy = np.trace(cm) / float(np.sum(cm))\n","    misclass = 1 - accuracy\n","\n","    if cmap is None:\n","        cmap = plt.get_cmap('Blues')\n","\n","    plt.figure(figsize=(8, 6))\n","    plt.imshow(cm, interpolation='nearest', cmap=cmap)\n","    plt.title(title)\n","    plt.colorbar()\n","\n","    if target_names is not None:\n","        tick_marks = np.arange(len(target_names))\n","        plt.xticks(tick_marks, target_names, rotation=45)\n","        plt.yticks(tick_marks, target_names)\n","\n","    if normalize:\n","        cm = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]\n","\n","\n","    thresh = cm.max() / 1.5 if normalize else cm.max() / 2\n","    for i, j in itertools.product(range(cm.shape[0]), range(cm.shape[1])):\n","        if normalize:\n","            plt.text(j, i, \"{:0.4f}\".format(cm[i, j]),\n","                     horizontalalignment=\"center\",\n","                     color=\"white\" if cm[i, j] > thresh else \"black\")\n","        else:\n","            plt.text(j, i, \"{:,}\".format(cm[i, j]),\n","                     horizontalalignment=\"center\",\n","                     color=\"white\" if cm[i, j] > thresh else \"black\")\n","\n","\n","    plt.tight_layout()\n","    plt.ylabel('True label')\n","    plt.xlabel('Predicted label\\naccuracy={:0.4f}; misclass={:0.4f}'.format(accuracy, misclass))\n","    plt.show()"],"execution_count":62,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":467},"id":"uX72iVZHTwMo","executionInfo":{"status":"ok","timestamp":1607246599982,"user_tz":300,"elapsed":1169,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"d02d2cb7-3cc0-4f8e-83d4-c28d97cb44a2"},"source":["plot_confusion_matrix(cm           = np.array([[37,  0, 12],\n","                             [ 6,  11,  5],\n","                             [3,  0, 26]]),\n","                      normalize    = False,\n","                      target_names = ['Neutral', 'Negative', 'Positive'],\n","                      title        = \"Confusion Matrix for Sample Dataset\")"],"execution_count":null,"outputs":[{"output_type":"display_data","data":{"image/png":"iVBORw0KGgoAAAANSUhEUgAAAewAAAHCCAYAAAAtjPomAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4yLjIsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+WH4yJAAAgAElEQVR4nOzdd5xcVfnH8c83FVIoIYAhoUkPIAESmiKhJ6EFRUARAUVAKQKioj9ERFRUuogaFAFFijTpoUszkAAhVAEpQggl9BJIsjy/P87ZOFm3zCa7M3v3ft95zSszt5z7zJ1knjnlnquIwMzMzLq2HvUOwMzMzNrmhG1mZlYATthmZmYF4IRtZmZWAE7YZmZmBeCEbWZmVgBO2FZXkhaVdLWktyX9bSHK2UvSjR0ZWz1Iul7SPgu47wmSZkp6uaPjqidJ50o6od5xmNWbE7ZVRdKXJE2R9J6kGTmxfKYDit4NWBZYKiK+sKCFRMQFEbFdB8QzH0mjJYWkK5osXy8vv73Kco6T9Je2touIsRFx3gLEuQLwbWB4RHyivfu3UOYukqZKeif/ELhV0sodUXat5M/o/fzv9nVJt0jaox37j5b0YmfGWMvjWLE5YVubJB0JnAb8jJRcVwDOAnbpgOJXBJ6MiLkdUFZneQ3YVNJSFcv2AZ7sqAMoWZj/jysAr0fEqwtw7F7NLFsVOJ/0I2BxYGXgN0DDQsRYL+tFxABgDeBc4ExJP6pvSGYLICL88KPFB+nL+j3gC61s05eU0F/Kj9OAvnndaOBF0hf/q8AMYL+87sfAbGBOPsbXgOOAv1SUvRIQQK/8el/gGeBd4Flgr4rld1XstxkwGXg7/71ZxbrbgZ8Ad+dybgQGt/DeGuP/HXBwXtYTmA4cC9xese3pwAvAO8D9wOZ5+Zgm7/Ohijh+muOYBayal+2f1/8WuKyi/F8AtwBqEuM2ef+Pc/nn5uU7A48Cb+Vy16rY5znge8A04KPG81uxfjdgaiuf+UbAP3PZM4AzgT4V6wP4JvBUPsc/AVYB7snn55LG7SvO8Q+AmTm2vSrKOhc4oeL1jsDUfOx7gE+1EmcAqzbz3j4kteoA7Ac8nuN8BjgwL+/f5Ly+ByzX2nsHBJxK+rf+DvAwsE7F/5OTgP8Ar5D+TS3a0nHq/X/fj673qHsAfnTtBynZzG36hd5km+OBScAywNL5S/Qned3ovP/xQG9gHPABsGRefxzzJ+imr1fKX7q98hfbO8Aaed0QYO38fF9ywgYGAW8Ce+f9vphfN35B3w78G1g9f2HeDpzYwntrTCabAffmZeOAicD+zJ+wvwwslY/5beBlYJHm3ldFHP8B1s779Gb+hN2PVIvfF9iclMyGtRZnxevVgfeBbXO53wWe5r+J5TlS0lseWLSZ8j5JSmqnAlsCA5qs3xDYJMe9EinhHV6xPoC/A4vl9/cR6cfGJ0k/Ah8D9mnyb+QUUlLbIsfe+DmfS07YwPqkZLgx6YfTPvm99G3hvDSXsHvn443Nr3cg/ZhQPvYHwAbNnde23juwPenH2hK5vLWAIXndqcBVpH+fA4GrgZ+3dBw//Gj6cJO4tWUpYGa03mS9F3B8RLwaEa+Ras57V6yfk9fPiYjrSDWINRYwno+BdSQtGhEzIuLRZrbZAXgqIv4cEXMj4kLgCWCnim3+FBFPRsQsUm1vRGsHjYh7gEGS1gC+QmoubrrNXyLi9XzMk0nJp633eW5EPJr3mdOkvA9I5/EU4C/AoRFRbT/nHsC1EXFTLvck0o+TzSq2OSMiXsjnoOl7eYaURIaSzs/MPPhrQF5/f0RMynE/B/yelOwq/TIi3smf0SPAjRHxTES8DVxPSr6VfhgRH0XEP4Brgd2beV8HAL+PiHsjoiFSf/9HpARalXw+ZpISJxFxbUT8O5J/kFpcNm9l/9be+xxSMl6T1BLyeETMkKQc+xER8UZEvEvqYtqz2rjNnLCtLa8Dg5vr56ywHPB8xevn87J5ZTRJ+B8AA9obSES8T0pEBwEzJF0rac0q4mmMaWjF68qR1NXG82fgEFKN84qmKyUdJenxPOL9LVJNcnAbZb7Q2sqIuJfUTCtS4qzWfOcgIj7Ox6o8B20de1JE7B4RS5MS2GeB/wOQtLqkayS9LOkdUvJp+l5fqXg+q5nXlef8zfz5Nmr6b6jRisC3Jb3V+CC1EjS3bbMk9Sa1BL2RX4+VNEnSG7m8cc28l8r9W3zvEXErqYn8N8CrkiZIWiwfrx9wf0XcN+TlZlVxwra2/JNUgxnfyjYvkb5IG62Qly2I90lfbI3mG/EcERMjYltSc/gTwNlVxNMY0/QFjKnRn0n9stfl2u88kjYnNTvvTmruX4LUf67G0Fsos9Xb5Uk6mFRTfymXX635zkGu4S3P/Oeg6lv1RcRk4HJgnbzot6Tzv1pELEbqf1YLu1djSUn9K1639G/oBeCnEbFExaNfbkWp1i6kJvH7JPUFLiO1QCybP7fraP1za/W9R8QZEbEhMJzUNfEdUo1+FqkLpzHuxSMNhmvpOGbzccK2VuXmy2OB30gaL6mfpN65VvLLvNmFwDGSlpY0OG/f5iVMLZgKfFbSCpIWB77fuELSsvlSo/6kHxHvkZrIm7oOWD1fitYrX8YzHLhmAWMCICKeJTV9/l8zqweSksBrQC9Jx5L6bxu9AqzUnpHgklYHTiD1je8NfFdSq033FS4BdpC0da5Rfpt0zu6p8tifkfR1Scvk12uSBrFNypsMJI0neC+v+0aVcbXmx5L65B8/OwLNXZd/NnCQpI3zyPr+knaQNLCK9zRI0l6k2u8vIuJ1oA/pB9FrwFxJY4HKywNfAZbK/xYbtfjeJY3KsfUm/fj8EPg4t3CcDZxacU6HStq+leOYzccJ29qU+2OPBI4hfbG9QGoavjJvcgIwhTTi+GHggbxsQY51E3BxLut+5k+yPXIcL5GaM7egmUSRv4h3JCWp10k10x0jYuaCxNSk7Lsiorma30RSE+eTpObcD5m/ybkx+bwu6YG2jpO7IP5CSiwPRcRTpJrcn3OtsK04/0VK9L8m1e52AnaKiNlt7Zu9RUrQD0t6L7+3K4DGH2lHAV8ijaw+m/SZLYyXSQMDXwIuAA6KiCeabhQRU4Cvk5qd3yQNpNu3jbIfyu/hadJAwSMi4thc3rvAYaQfOG/m93RVxfGeIP0gfSY3ZS9H6+99sbzsTdK/g9eBX+V138sxTMpN6TeTxzi0cByz+SjCLTFmVj+SRpNG0A+rdyxmXZlr2GZmZgXghG1mZlYAbhI3MzMrANewzczMCsAJ28zMrABam73KMvVaNNSnzcs8rSDWX2uFeodgHeztD+e0vZEVxr8fmzYzz7DXqXoutmLE3P+ZmbfdYtZrEyNiTAeE1Con7Cqoz0D6rtHctMZWRHffe2a9Q7AOdt2jM+odgnWgz49YrunUwp0i5s7qkO/2D6f+pq0piDuEE7aZmZWUYKFuQ19bTthmZlZOArQwU+DXlhO2mZmVV4Fq2MWJ1MzMrMRcwzYzs/Jyk7iZmVlX50FnZmZmxVCgGnZxflqYmZmVmGvYZmZWTsJN4mZmZl2f3CRuZmZmHcs1bDMzKy83iZuZmRVAgZrEnbDNzKykanMdtqRFgDuAvqS8e2lE/EjSucAWwNt5030jYmpL5Thhm5mZda6PgK0i4j1JvYG7JF2f130nIi6tphAnbDMzK6ca3a0rIgJ4L7/snR/R3nKK09tuZmbW0dRj4R/VHEbqKWkq8CpwU0Tcm1f9VNI0SadK6ttaGU7YZmZWUuqohD1Y0pSKxwFNjxQRDRExAhgGbCRpHeD7wJrAKGAQ8L3WonWTuJmZ2cKZGREjq9kwIt6SdBswJiJOyos/kvQn4KjW9nUN28zMyquHFv7RBklLS1oiP18U2BZ4QtKQvEzAeOCR1spxDdvMzMqpdnOJDwHOk9STVFG+JCKukXSrpKVzJFOBg1orxAnbzMzKqzajxKcB6zezfKv2lOMmcTMzswJwDdvMzEqqNjOddRQnbDMzK68CzSVenJ8WZmZmJeYatpmZlZebxM3MzLo4qVBN4k7YZmZWXgWqYRcnUjMzsxJzDdvMzMrLTeJmZmZdna/DNjMzK4YC1bCL89PCzMysxFzDNjOzcqrd3bo6hBO2mZmVlPuwzczMisF92GZmZtaRXMM2M7PycpO4mZlZAbhJ3MzMzDqSa9hmZlZO8ihxMzOzYihQk7gTtpmZlZYKlLCL0xZgZmZWYq5hm5lZKYli1bCdsM3MrJyUHwXhhG1mZiUl17Ct6+vbpxc3//Fw+vTpRa+ePbni5gc54XfXcfMfD2dA/0UAWGbQQKY88hy7H3l2naO19rpx4g0cdeS3aGhoYN+v7s93vnt0vUOydvjNj45gyh03s/igwZx22W0AnHfK8Uy54yZ69e7DJ4atyCE/PpX+iy1e50itlpywS+qj2XMZc8AZvD9rNr169eDWc47kxrsfY5uvnTZvmwtP2p+rb59WxyhtQTQ0NHD4YQdz7fU3MXTYMD6zySh23HFn1ho+vN6hWZVG77wHY/fcjzOO+da8Zett8lm+fNgP6NmrF38+7QQuP+fX7H34MXWMsnsoUg3bo8RL7P1ZswHo3asnvXr1JCLmrRvYfxG2GLU6V9/mhF00k++7j1VWWZWVP/lJ+vTpwxf22JNrrv57vcOydlh7w00YsNiS8y0bsdloevZKdazVP7Uhr78yox6hdTuSFvpRK07YJdajh5h00dH855YTuXXSE0x+5Pl563ba8lPcft+/ePf9D+sYoS2Il16azrBhy897PXToMKZPn17HiKyj3XLlhaz/ma3qHUa34IRdBUkh6eSK10dJOm4By1pC0jcXcN/nJA1ekH2L7uOPg032PJFVtz+GkeusyPBVhsxbt/uYDbnkhvvrGJ2ZNefSs0+nZ89efHbc5+oditVYPWvYHwGf66BkuQTQbMKW5H76Nrz93iz+MeVJttss9XEutUR/Rq69Etff+UidI7MFsdxyQ3nxxRfmvZ4+/UWGDh1ax4iso9z694u5/86bOfxnZxaq77XLUgc9aqSeCXsuMAE4oukKSUtLukzS5Pz4dF5+nKSjKrZ7RNJKwInAKpKmSvqVpNGS7pR0FfBY3vZKSfdLelTSATV4f13a4CUHsPiARQFYpG9vtt54Tf713CsA7LrN+lx/5yN8NHtuPUO0BTRy1Ciefvopnnv2WWbPns3fLr6IHXbcud5h2UJ68O7b+Pt5Z3H0aefSd9F+9Q6nWxAL3xxeyx9O9a59/gaYJumXTZafDpwaEXdJWgGYCKzVSjlHA+tExAgASaOBDfKyZ/M2X42INyQtCkyWdFlEvN6Rb6ZIPjF4Mc4+fm969uhBjx7ispsemFej/sL2G3LSn26sc4S2oHr16sWpp5/JTjtsT0NDA/vs+1WGr712vcOydjjl6G/w6JR/8u5bb/D17TZkj298myvOOZM5sz/i+IP2ANLAswOP+UWdIy2+IrVU1DVhR8Q7ks4HDgNmVazaBhhecSIXkzSgncXfV5GsAQ6TtGt+vjywGtBiws618FQT793eQ3d9jzz1Ept+sfn/7Nt//fQaR2MdbczYcYwZO67eYdgCOvLE3/7Psm12/VIdIrGupN41bIDTgAeAP1Us6wFsEhHzDVGWNJf5m/EXaaXc9yv2G036EbBpRHwg6fY29iUiJpCa7OnRb5lobVszMyumItWw635ZV0S8AVwCfK1i8Y3AoY0vJI3IT58jNXUjaQNg5bz8XWBgK4dZHHgzJ+s1gU06JHgzMyu0IvVh1z1hZycDlaPFDwNGSpom6THgoLz8MmCQpEeBQ4AnAXJf9N15ENqvmin/BqCXpMdJA9QmddL7MDMz6xR1axKPiAEVz18B+lW8ngns0cw+s4DtWiivaQfP7RXrPgLGtrDfSu0I28zMuosaXZYlaRHgDqAvKe9eGhE/krQycBGwFHA/sHdEzG6pnK5SwzYzM6u5GjWJfwRsFRHrASOAMZI2AX5BuiJqVeBN5u8a/h9O2GZmVkq1ug47kvfyy975EcBWwKV5+XnA+NbKccI2MzPrZJJ6SpoKvArcBPwbeCsiGmeoehFodUrCrnBZl5mZWV100CjvwZKmVLyekC8NniciGoARkpYArgDWbO9BnLDNzKy8OmbQ2cyIGFnNhhHxlqTbgE2BJST1yrXsYUCrt9Vzk7iZmZWTajPoTOn+GEvk54sC2wKPA7cBu+XN9gFavXG9a9hmZmadawhwnqSepIryJRFxTZ5n5CJJJwAPAn9srRAnbDMzK61azFQWEdOA9ZtZ/gywUbXlOGGbmVlpFWkucSdsMzMrpcbrsIvCg87MzMwKwDVsMzMrr+JUsJ2wzcyspFSsPmw3iZuZmRWAa9hmZlZaRaphO2GbmVlpOWGbmZkVQXHytfuwzczMisA1bDMzKy03iZuZmXVx1d5tq6twwjYzs9IqUsJ2H7aZmVkBuIZtZmalVaQathO2mZmVV3HytRO2mZmVV5Fq2O7DNjMzKwDXsM3MrJwKdrcuJ2wzMyslAQXK124SNzMzKwLXsM3MrKQ805mZmVkhFChfO2GbmVl5FamG7T5sMzOzAnAN28zMykluEjczM+vyBPToUZyM7YRtZmalVaQatvuwzczMCsA1bDMzK60ijRJ3wjYzs3LyoDMzM7OuL80lXpyM7T5sMzOzAnAN28zMSspziZuZmRVCgfK1m8TNzMyKwDVsMzMrLTeJm5mZdXUFu6zLTeJmZlZKjZd1LeyjzeNIy0u6TdJjkh6V9K28/DhJ0yVNzY9xrZXjGraZmVnnmgt8OyIekDQQuF/STXndqRFxUjWFOGGbmVlp1aJJPCJmADPy83clPQ4MbW85bhI3M7PSqkWTeJPjrQSsD9ybFx0iaZqkcyQt2dq+TthmZlZa0sI/gMGSplQ8Dmj+WBoAXAYcHhHvAL8FVgFGkGrgJ7cWq5vEzczMFs7MiBjZ2gaSepOS9QURcTlARLxSsf5s4JrWynDCrsLw1YZx6XW/qHcY1kFu+9er9Q7BOth6Q5aodwhWRKrNddhKB/kj8HhEnFKxfEju3wbYFXiktXKcsM3MrJTSZV01OdSngb2BhyVNzct+AHxR0ggggOeAA1srxAnbzMxKqjY3/4iIu0i/D5q6rj3leNCZmZlZAbiGbWZmpVWkqUmdsM3MrLR88w8zM7Ouzjf/MDMzs47mGraZmZVS4926isIJ28zMSqtICdtN4mZmZgXgGraZmZVWgSrYTthmZlZeRWoSd8I2M7Ny8mVdZmZm1tFcwzYzs1JSjW7+0VGcsM3MrLQKlK+dsM3MrLx6FChjuw/bzMysAFzDNjOz0ipQBdsJ28zMyknyddhmZmaF0KM4+dp92GZmZkXgGraZmZWWm8TNzMwKoED52k3iZmZmReAatpmZlZJI05MWhRO2mZmVVpFGiTthm5lZOalYN/9wH7aZmVkBuIZtZmalVaAKthO2mZmVkyjW3bqcsM3MrLQKlK/dh21mZlYErmGbmVlpFWmUuBO2mZmVUrq9Zr2jqJ4TtpmZlVa3GHQm6ddAtLQ+Ig7rlIjMzMzsf7RWw55SsyjMzMzqoDj161YSdkScV/laUr+I+KDzQzIzM6uNIg06a/OyLkmbSnoMeCK/Xk/SWZ0emZmZmc1TzXXYpwHbA68DRMRDwGc7MygzM7POlmY6W/hHm8eRlpd0m6THJD0q6Vt5+SBJN0l6Kv+9ZGvlVDVxSkS80GRRQzX7mZmZdVn5bl0L+6jCXODbETEc2AQ4WNJw4GjglohYDbglv25RNQn7BUmbASGpt6SjgMeridDMzKwra7wWe2EebYmIGRHxQH7+LimHDgV2ARrHi50HjG+tnGoS9kHAwbnwl4AR+bWZmZm1g6SVgPWBe4FlI2JGXvUysGxr+7Y5cUpEzAT2WrgQzczMup4OGiU+WFLlpdATImJCM8caAFwGHB4R71QeOyJCUotzn0AVCVvSJ4HTSe3uAfwTOCIinqnqbZiZmXVBjYPOOsDMiBjZ6rGk3qRkfUFEXJ4XvyJpSETMkDQEeLW1MqppEv8rcAkwBFgO+BtwYRX7mZmZdWm1GHSmtNEfgccj4pSKVVcB++Tn+wB/b62cahJ2v4j4c0TMzY+/AItUsZ+ZmZnBp4G9ga0kTc2PccCJwLaSngK2ya9b1Npc4oPy0+slHQ1cRGoS3wO4rgPegJmZWV3VYp6ziLirlUNtXW05rfVh309K0I0HObDy+MD3qz2ImZlZVyN1k7t1RcTKtQzE6uudt9/ih0cdzFNPPIYkTjjlt6w/cuN6h2VVOvWYb3HfHTexxKDB/PbKOwC4c+JVXHDWSbzwzJOceuENrL7OiDpHaQtqi5Fr0r//QHr27EHPXr248sa76x1St1GgfF3d/bAlrQMMp6LvOiLO76ygrPZ+dux3+czobTn97AuYPXs2H87yfV6KZJvxe7LTl77GyT84ZN6yFVddk2NOO4df//g7dYzMOspfLr+eQUsNrncYVkfVXNb1I2A0KWFfB4wF7gKcsLuJd995mymT7ubnp/0egD59+tCnT586R2Xtse7ITXll+n/mW7bCKqvXKRqz4uhWd+sCdiN1ir8cEfsB6wGLd2pUVlMv/ud5Bi01mB8ccRCf23Yzjvn2wXzwwfv1DsvMMiH23WMndtl2My46/4/1DqdbqcXUpB2lmoQ9KyI+BuZKWox0Yffybe0kKSSdXPH6KEnHLXCkLR/nB01e39PRx+juGhrm8tjDU9nzK/tz+U330K9fP84+8+S2dzSzmrjo6pu56uZ/cs5fr+Qvf5rAff+8q94hWR1Uk7CnSFoCOJs0cvwB0mxnbfkI+Jykzu50mS9hR8RmnXy8bmfZIUNZdshQ1ttgFADb7Tiexx5+qM5RmVmjTwwZCsBSSy/DtuN2YtqDU9rYw6ohRA8t/KNW2kzYEfHNiHgrIn4HbAvsk5vG2zIXmAAc0XSFpKUlXSZpcn58umL5Tfl+oX+Q9Hxjwpd0paT787oD8rITgUXzRegX5GXv5b8vkrRDxTHPlbSbpJ6SfpWPO03SgU3jK5ull1mWIcsN5dmnnwRg0p23s+pqa9Y5KjMD+OD993nvvXfnPb/r9ltYbc3hdY6qm+iA5vBaNom3NnHKBq2ta7xVWBt+A0yT9Msmy08HTo2IuyStAEwE1gJ+BNwaET+XNAb4WsU+X42INyQtCkyWdFlEHC3pkIho7nqVi4HdgWsl9SH1w38jl/l2RIyS1Be4W9KNEfFsFe+n2/q/E07mO4d8jTlzZrP8Civz01N/W++QrB1+8Z0DmTb5Ht556w323noEX/7mdxi4+JL89uc/4O03Xue4b+7FJ9dchxMmXFzvUK2dZr72Kt/cb08A5jbMZeddd2eLrbarc1TdR5EGnbU2Sry1TswAtmqr8Hw3kvOBw4BZFau2AYZXnKjF8l1MPgPsmve9QdKbFfscJmnX/Hx5YDXg9VYOfz1wek7KY4A7ImKWpO2AT0naLW+3eC5rvoSda/EHACw3tM0u+8Jba51PcekNd9Y7DFtA3/vV75tdvtk242ociXW0FVZamWtuu7feYVgX0NrEKVt20DFOI/V7/6liWQ9gk4j4sHLDln7pSBpNSvKbRsQHkm6njfnMI+LDvN32pOlUL2osDjg0Iia2sf8EUpM+66y3Qau3PDMzs2KqZiBXV9HpsUbEG6S7fVU2b98IHNr4QlJjk/bdpGZsck14ybx8ceDNnKzXJN3qs9GcfNuy5lwM7AdsDtyQl00EvtG4j6TVJfVfwLdnZmYFJWpzt66OUqsfFycDlaPFDwNG5kFfjwEH5eU/BraT9AjwBeBl4F1Ssu0l6XHS3UwmVZQ1gdRPfkEzx70R2AK4OSJm52V/AB4DHsjH+T1VzvhmZmbdSw8t/KNWOi1RRcSAiuevAP0qXs8kNVM39TawfUTMlbQpMCoiPsrrxrZwnO8B32vhuHOAQU22/5h0Kdh8l4OZmZl1ZdVMTSpgL+CTEXF8HtX9iYi4rxPiWQG4RFIPYDbw9U44hpmZGVDbGvLCqqaGfRbwMWlU+PGkJurLgFEdHUxEPAWs39HlmpmZNZWuoy5Oxq4mYW8cERtIehAgIt7M1zWbmZkVWpFq2NUMOpsjqSfp2mskLU2qcZuZmVmNVFPDPgO4AlhG0k9Jd+86plOjMjMzq4ECtYi3nbAj4gJJ95Om9hQwPiIe7/TIzMzMOpGgpjfvWFjVjBJfAfgAuLpyWUT8pzMDMzMz62xFmumsmibxa0n91yJNB7oy8C9g7U6My8zMzCpU0yS+buXrfBevb3ZaRGZmZjVSoBbx9s90FhEPSNq4M4IxMzOrFUndrg/7yIqXPYANgJc6LSIzMzP7H9XUsAdWPJ9L6tO+rHPCMTMzq50CVbBbT9h5wpSBEXFUjeIxMzOrmSLNdNZiwpbUK98169O1DMjMzKwWutN12PeR+qunSroK+BvwfuPKiLi8k2MzMzOzrJo+7EWA10l362q8HjsAJ2wzMyu0AlWwW03Yy+QR4o/w30TdKDo1KjMzs86mbtKHDfQEBjB/om7khG1mZoWnZlNc19Rawp4REcfXLBIzMzNrUWsJuzg/O8zMzNopjRKvdxTVay1hb12zKMzMzOqgWyTsiHijloGYmZnVmgo0TLxItwI1MzMrrXbfrcvMzKw7KFoftmvYZmZWTkoTpyzso83DSOdIelXSIxXLjpM0XdLU/BjXVjlO2GZmZp3rXGBMM8tPjYgR+XFdW4W4SdzMzEqrFjf/iIg7JK20sOW4hm1mZqXU2Ie9sI+FcIikabnJfMm2NnbCNjOz0uqgPuzBkqZUPA6o4tC/BVYBRgAzgJPb2sFN4mZmZgtnZkSMbM8OEfFK43NJZwPXtLWPE7aZmZWU6FGnWbglDYmIGfnlrqQ7Y7bKCdvMzEpJ1OZ+2JIuBEaTms5fBH4EjJY0gnT3y+eAA9sqxwnbzMzKqUb3w46ILzaz+I/tLceDzszMzArANWwzMyutWlyH3VGcsM3MrJRq1YfdUZywzcystIpUw3YftpmZWQG4hm1mZqVVoAq2E7aZmZWTKFYzc5FiNTMzKy3XsM3MrJwEKlCbuBO2maKhz4wAAB7fSURBVJmVVnHStRO2mZmVVLofdnFStvuwzczMCsA1bDMzK63i1K+dsM3MrMQK1CLuhG1mZmWlQo0Sdx+2mZlZAbiGbWZmpVS0mc6csM3MrLSK1CTuhG1mZqVVnHTthF2Vnj3EEv161zsM6yBbLr1MvUOwDrbR8TfXOwSzTueEbWZm5eS5xM3MzLq+og06K1KsZmZmpeUatpmZlZabxM3MzAqgOOnaCdvMzEqsQBVs92GbmZkVgWvYZmZWSmmUeHGq2E7YZmZWWkVqEnfCNjOzkhIqUA3bfdhmZmYF4Bq2mZmVlpvEzczMujgPOjMzMysCFauG7T5sMzOzAnAN28zMSqtINWwnbDMzK60iXdblhG1mZqUkoEdx8rX7sM3MzIrACdvMzEpLHfCnzWNI50h6VdIjFcsGSbpJ0lP57yXbKscJ28zMSkta+EcVzgXGNFl2NHBLRKwG3JJft8oJ28zMrBNFxB3AG00W7wKcl5+fB4xvqxwPOjMzs9LqoFHigyVNqXg9ISImtLHPshExIz9/GVi2rYM4YZuZWSl14CjxmRExckF3joiQFG1t54RtZmYlVdfba74iaUhEzJA0BHi1rR3ch21mZlZ7VwH75Of7AH9vawfXsM3MrJxqdPMPSRcCo0l93S8CPwJOBC6R9DXgeWD3tspxwjYzs9KqRYN4RHyxhVVbt6ccJ2wzMyulNOisOHOTug/bzMysAFzDNjOz0ipO/doJ28zMyqxAGdsJ28zMSqtI98N2H7aZmVkBuIZtZmalVaBB4k7YZmZWXgXK124SNzMzKwLXsM3MrLwKVMV2wjYzs1ISxRol7oRtZmblVKObf3QU92GbmZkVgGvYZmZWWgWqYDthm5lZiRUoYzthm5lZSalQg87ch21mZlYArmGbmVlpFWmUuBO2mZmVkihUF7YTtpmZlViBMrb7sM3MzArANWwzMyutIo0Sd8I2M7PS8qAzK5QPP/yQXcdtzeyPPmJuw1x23PlzfOcHx9Y7LFsIN068gaOO/BYNDQ3s+9X9+c53j653SNYOyy7Wl59+fm2W6t+HAC6bMp0LJr0AwBc3Xp49NxpGQwR3PjmTU298ur7BWs04YRt9+/bl0qsm0n/AAObMmcMuY7Zkq223Z8NRG9c7NFsADQ0NHH7YwVx7/U0MHTaMz2wyih133Jm1hg+vd2hWpYaPg5NveIrHZ7xLvz49ueigjfjnv99gqQF92HLNwex21iTmNASD+veud6iFV6AKtgedGUii/4ABAMyZM4c5c+agIrUT2Xwm33cfq6yyKit/8pP06dOHL+yxJ9dc/fd6h2XtMPO92Tw+410APpjdwLOvfcAyi/Vl91HD+OOdzzOnIQB44/059Qyz+NRBjxpxwjYg1cq2+cwo1l1tGFtsuTUbjNyo3iHZAnrppekMG7b8vNdDhw5j+vTpdYzIFsZySyzCmkMG8vCLb7PiUv3YcMUluOCAUZzz1Q1Ze7nF6h1e4akD/tRKXRK2pAZJUyU9Iulvkvq1c//lJF2an4+QNK5i3c6S3GHXTj179uTmuybzwKPP8OD9U3jisUfrHZJZ6S3apyen7Pkpfnn9v3j/owZ69RCLLdqbvSZM5pSJT3HSHuvWO0SroXrVsGdFxIiIWAeYDRzUnp0j4qWI2C2/HAGMq1h3VUSc2HGhlsviSyzBpzffgttumVjvUGwBLbfcUF588YV5r6dPf5GhQ4fWMSJbEL16iFP2/BTXTnuZWx5/DYBX3vmQWx5/FYBHpr/DxxEs2c/92AtKpFHiC/uola7QJH4nsKqkQZKulDRN0iRJnwKQtEWujU+V9KCkgZJWyrXzPsDxwB55/R6S9pV0pqTFJT0vqUcup7+kFyT1lrSKpBsk3S/pTklr1vH9193Mma/x9ltvATBr1iz+cfstrLraGnWOyhbUyFGjePrpp3ju2WeZPXs2f7v4InbYced6h2Xt9OPxw3n2tff58z3/mbfs1sdfY9TKSwKw4lL96N2zB29+4H7shVGgLuz6jhKX1AsYC9wA/Bh4MCLGS9oKOJ9Uez4KODgi7pY0APiwcf+ImC3pWGBkRBySy9w3r3tb0lRgC+A2YEdgYkTMkTQBOCginpK0MXAWsFWT2A4ADgAYuvwKnXYOuoJXX36Zb33jazQ0NPBxfMzO43dj2zE71DssW0C9evXi1NPPZKcdtqehoYF99v0qw9deu95hWTusv8Li7DRiCE++/C6XfCNdrXHGzU9zxYMvcfz44Vx+8CbMafiYYy5319VCK9D42nol7EVzMoVUw/4jcC/weYCIuFXSUpIWA+4GTpF0AXB5RLzYjhHMFwN7kBL2nsBZOelvBvytopy+TXeMiAnABID11t8w2v8Wi2P4Outy05331TsM60Bjxo5jzNhxbW9oXdKD/3mbTx17c7PrfnCZk3RZ1Sthz4qIEZULWkrCEXGipGtJ/dR3S9qeilp2G64CfiZpELAhcCvQH3ir6fHNzKx8ijQ1aVfow250J7AXgKTRwMyIeEfSKhHxcET8ApgMNO1vfhcY2FyBEfFe3ud04JqIaIiId4BnJX0hH0uS1uuUd2RmZl2aB50tmOOADSVNA04E9snLD88DzKYBc4Drm+x3GzC8cdBZM+VeDHw5/91oL+Brkh4CHgV26bi3YWZmReFBZ22IiAHNLHsDGN/M8kObKeI5YJ2K/UY1WX9uxf6X0uScRsSzwJh2hm1mZlY3nkvczMzKqzhd2E7YZmZWTqlJuzgZ2wnbzMysk0l6jjRIugGYGxEj21uGE7aZmZVTjUd5A1tGxMwF3dkJ28zMSqs4DeJd67IuMzOz2uqY67oGS5pS8TigmSMFcGO+h0Vz69vkGraZmdnCmVlFn/RnImK6pGWAmyQ9ERF3tOcgrmGbmVlJqUP+VCMipue/XwWuADZqb7RO2GZmVlq1mJo03955YONzYDvgkfbG6iZxMzMrpRpOLboscEW+yVUv4K8RcUN7C3HCNjMz60QR8Qyw0DeZcsI2M7PyKtB1XU7YZmZWWp6a1MzMrABqPNPZQvEocTMzswJwDdvMzEqrQBVsJ2wzMyup2t/8Y6E4YZuZWYkVJ2O7D9vMzKwAXMM2M7NSEm4SNzMzK4QC5Ws3iZuZmRWBa9hmZlZabhI3MzMrAE9NamZmVgTFydfuwzYzMysC17DNzKy0ClTBdsI2M7NykqcmNTMzK4YiDTpzH7aZmVkBuIZtZmblVZwKthO2mZmVV4HytRO2mZmVV5EGnbkP28zMrABcwzYzs5JSoUaJO2GbmVkpFe1+2G4SNzMzKwAnbDMzswJwk7iZmZVWkZrEnbDNzKy0ijTozE3iZmZmBeAatpmZlZPv1mVmZtb1CU9NamZmVgwFytjuwzYzMysA17DNzKy0ijRK3AnbzMxKy4POzMzMCqBA+dp92GZmZkXghG1mZuWlDni0dQhpjKR/SXpa0tELGqqbxM3MrLQ6e9CZpJ7Ab4BtgReByZKuiojH2luWa9hmZmadZyPg6Yh4JiJmAxcBuyxIQa5hV2Ha1AdmDlmi7/P1jqMGBgMz6x2EdRh/nt1PWT7TFWtxkAcfuH9ivz4a3AFFLSJpSsXrCRExIT8fCrxQse5FYOMFOYgTdhUiYul6x1ALkqZExMh6x2Edw59n9+PPtGNFxJh6x9AebhI3MzPrPNOB5SteD8vL2s0J28zMrPNMBlaTtLKkPsCewFULUpCbxK3ShLY3sQLx59n9+DMtmIiYK+kQYCLQEzgnIh5dkLIUER0anJmZmXU8N4mbmZkVgBO2mZlZAThhm5mZFYATtlVN0sD8d5FucGNm1i04YVublKwITJG0YUSEk7ZZ1+L/k92fE7a1KZLngXOBP0ka4aTdfTR+jpKGSFqu3vFY+0lS5Et+JK0laXn//+x+fFmXtSr/p1dEfJxffwf4KvCliHiw8ovCikvSeOBw4G3gCeDXEfFifaOy9srX++4OTAXWAbb2/8/uwzVsa1FjMo6IjyUtCRARvwLOBi6UtL5r2sUnaV3gSGBH4D5gS1LitgKRtD2wK7AD8A4wt74RWUdzwrYWVTSxHQGcKukCSStHxCnAWcD5kkb5F3zhNQDXAF8gfdnvGRHvSlq7vmFZO71Fmgltf9ItHXfMP6i3q29Y1lE8Nam1StLBwM6kL/IHgbMl/TAizpDUDzhT0mcj4qO6BmrtJmk4sDbpc90c+ATwxYh4RtJY4IeSPhcRL9czTmudpP2A3sAtwHXAMxExKq/bFxgn6d6IcKtJwbmGbfNppnl7KeArwIHAk8D9wO8lbR4RJwJjnKwL69PAERHxNOnL/ilgtKQvAScBP3Oy7nokNf3efo70o3o68A1gOUl7Sfo/4DDgeCfr7sE1bJtPRTP4d4G+wE+A1UjNa1vndZ8D9pQ0OSLerFuw1i6NYxIk9YqIuRFxtqTRkg6NiNMk7Q+sCAwiJfIbPaiw62kcAFphGvA8sHFEXCLpY2BjIEiDQ5+odYzWOZyw7X9I2hXYBDg0f8G/kZePJ7XKPAj8MiI+rGOYViVJqwPrRcTfJG0IbCnp6Yi4EvgTsD1ARPwhb987IubkZU7WXUQeU7BhRJwvaUfgm8ARwDPAXaTuqU0i4lLg0jqGap3ETeKGpL4Vz4cCWwPrA6/kxbOAC4D9gOOAH+frsq0YegCv5pnqXgT6AAdL+jVpJPFYSXtXbO/RxV1MbgZfCrhO0srAbcDDwKHAecAU4B/AmLoFaZ3O12GXnKT+wL7AjcBawBqkgSs/BWaQatlzJS1K+uLvHxGv1ilcW0CSegEzge9FxO/z53kyqSn1UNK11+Mj4r06hmnNkNQnImbn58OAHwMP5YGfS5LGmOwBrECqaX/RLSPdkxO2IWkH4HzgdWDNfN31uqQmtznAtxubSK0Y8gj+bSPi75I2BmYDAm4AfhoRp+da2ydIE208FRHX1i9ia46kxUmDA+8ANiONBu9DagV7FjgtIhryiP/1SIn8sXrFa53LCduQtBapWW0g6Rrch3KNbHXgKOCtiDiynjFa+0k6FxgJfAh8Pc9MtwFwM3BMRJzVZHsPMOtC8v/BnqQWsK+QmsTXyuNKdiKNPXgeODUi3I1RAu7DLrk84rsvsCnwQ+DPkrbMXwCLAb8HTqxjiNZOFZfm/Zw04ntuRDwIEBEPANsAp0v6VuV+TtZdh6Q1gbPyJZPvABsC/yQlbYCbSF1XawKH1CVIqznXsEtO0nHAeFINbHKehOGHwOWkgWd7+Vrc4qi4dKsHMABYEjgHmBMRYyq2Ww1YKSJuqlOo1gpJPUmf3arA48AQYBdgGCmRPy5pDdKYk0keV1IOTtglJWnFxpHekr5NGrRycE7aOwA7AadHxOP1jNOqV5GstyNdlvdyREzI624F3gdOAH4J7BoRb7gZvGuR1KPyOmtJZwPDgXGkFq8D899vA0uTBhF6UpSScMIuodyP+XXg+oi4Ki/7Pmm08Bci4m5JPSOioZ5xWvtJGkMa/X0IcCFwGfDDnJwvJNXazmr83K3raHKLzO1Js88F8DNgFPA5YFHSIMHxwGER8XCdwrU6cMIugaa1KElLkX6pDwZuaRwdLOle4DXg855utFhyE/hA0uDBHwLLAr8iTVf5FunyvDclLRERb7lm3XXl+fsPBcbled17kFpFRpAGhc6UtIgnLiofJ+xursmv9n1IA8zeAy4mjQBfmjRz2VzSYKSfRsRz9YnW2quiGbxfRHyQf4wNIiXuzUk1speBX5PmlJ5Vx3CtDZI2B04nzdH/ap6Z7mXSj64TgVVI3VUf+wdX+Xhq0pKQdBCwF3A0cCfwJmlayl1I/WPDgS87WRdHRbLeGDhL0r4R8bCkZUjXXS9JGlV8K3C5k3XX00xLxxzSLGZ7SVoOGAu8AHw/Ig6VtKy7qsrLl3V1U5JWkNQ/f6EvRaptjQfWJV0ScnNEvBoRZ0fEXsDWEfFoPWO29smf7RjSeISewERJ6+aBgveRppO9DvhNREyuY6jWjCatX8MkDSZ9bh+R5kC4OiLWIV1rPRIgIl5pqTzr/twk3g1JWhb4AemX+e8i4j1Jp5GaR5ch3cFnVh4dfn9E3F6/aG1B5TmlbwD2i4h7JB1LmmRjB+DfpC/5uRFxX/2itKaaGVNyGPAl0ij+p4BDGidCyTfiOZY0GPTpesRrXYdr2N3Ta8BkYDlgvzyRxgxgH2DvnKx3JzWR+yYexfU6cC/pbk1ExPGkuaQnAstGxD1O1l3SvK7I3Ge9L2kE+E6k+cAvyOvGkEb7f8XJ2sB92N1KngyjR0T8S9IFpGs1xwIHRMQvJK0IXCvpBdKEDPtExLN1DNnaoaLPenGAiHhb0mKkL/vGaUYvANYG/i7ps76ZR9ciaVvgq5IeIt1h60VgEjAj17rHSZok6fOk7owHPCmKNXLC7iZyP/W/gJmSfgw0ABOAxYFVJR0YEd+UtA7pc58ZES/WL2Jrr4o5pI8E3pQ0iTSI8MJ8F6dZpOS9H+myvf6kKwKsC8g15uOBP5O7poAHSNOLrgtMy5veSvq4Z5E+UzPACbvbiIjXJW1DurFDD9Kdey4mfWHPBtbJTePn+vrN4mgyMGkT0tiELwBfJk0n+0tJe5AuyVuBdJOIwaQ7PH3cfKlWa5IGkWrMu0TE1ZJWIF1bPRX4AJgg6a+ka+l3As6tV6zWdTlhdyMRcWueIekMUsJeFtgK2BPYiPRL/kLS3Zusi5O0NDBe0oW5absP6YYem5Iux9subzo78p23JG0GnE26t/VrdQjbmpFnmtsJ+KWkf0TEfyQF6e5bZ0t6hzRP+LKkAWZP1jVg65I8SrwbynOBnwpskr8oliTdR7efr7MuDknjgR1JtbBzSdNTnkkabLZznrFsW+Cg/HiddJOIXo3zxFvXImks6Qf1RNKg0L0j4v36RmVF4Rp2NxQR10r6GJgkadOIeL3eMVn1KuZxv5p0ffVo0hf7byVdDuwKDMmtKccC362oTU+vR8xWnYi4XtI3gBuBT0TE+5IW9aQ2Vg3XsLsxSbsAxwEbVt4ByLqufMvE/Ulf6HdExEe5VjYWeCwifqd0S9QhwBLAOREx0XODF0v+TE8CtvQocKuWE3Y3J2mAL+0pDklbkKamfAq4BPgk6SYe25L6sF8iDRwM3wCi2PIP6h+RJrgJ/+Cytjhhm3Uxkj4DXANsDHyeNCf4rqRrdlcltZqcA+CWk2LzD2prD/dhm3UxEXGXpC8ClwKbRcS7kq4hXat7APCsE3X34GRt7eEatlkXJWkc6baYoyLijbyscbYz91mblYxr2GZdVERcl0f7PyFpjYh4szFJO1mblY9r2GZdXL6u/n3fVc2s3JywzQrCzeBm5eaEbWZmVgC+H7aZmVkBOGGbmZkVgBO2mZlZAThhm3UQSQ2Spkp6RNLfJPVbiLLOlbRbfv4HScNb2XZ0vq1me4/xnKTB1S5vsk27JvyQdJyko9obo5n9lxO2WceZFREjImIdYDbplpfzSFqgeQ8iYv+IeKyVTUYD7U7YZlYsTthmneNOYNVc+71T0lXAY5J6SvqVpMmSpkk6ENIlW5LOlPQvSTcDyzQWJOl2SSPz8zGSHpD0kKRbJK1E+mFwRK7dby5paUmX5WNMlvTpvO9Skm6U9KikPwBq601IulLS/XmfA5qsOzUvv0XS0nnZKpJuyPvcKWnNjjiZZuaZzsw6XK5JjwVuyIs2ANaJiGdz0ns7IkZJ6gvcLelGYH1gDWA4sCzwGPkGHxXlLg2cDXw2lzUoIt6Q9DvgvYg4KW/3V+DUPCf5CsBEYC3SnaHuiojj82QsX6vi7Xw1H2NRYLKky/L91fsDUyLiCEnH5rIPASYAB0XEU5I2Bs4CtlqA02hmTThhm3WcRSVNzc/vBP5Iaqq+LyKezcu3Az7V2D8NLA6sBnwWuDAiGoCXJN3aTPmbkO6R/SxA4/zizdgGGC7Nq0AvJmlAPsbn8r7XSnqzivd0mKRd8/Plc6yvAx8DF+flfwEuz8fYDPhbxbH7VnEMM6uCE7ZZx5kVESMqF+TE9X7lIuDQiJjYZLtxHRhHD2CTpvfKrkiiVZE0mpT8N42IDyTdDizSwuaRj/tW03NgZh3DfdhmtTUR+Iak3gCSVpfUH7gD2CP3cQ8Btmxm30nAZyWtnPcdlJe/Cwys2O5G4NDGF5IaE+gdwJfysrGk+2y3ZnHgzZys1yTV8Bv1ABpbCb5Eamp/B3hW0hfyMSRpvTaOYWZVcsI2q60/kPqnH5D0CPB7UkvXFcBTed35wD+b7hgRr5Huh325pIf4b5P01cCujYPOgMOAkXlQ22P8d7T6j0kJ/1FS0/h/2oj1BqCXpMeBE0k/GBq9D2yU38NWwPF5+V7A13J8jwK7VHFOzKwKnkvczMysAFzDNjMzKwAnbDMzswJwwjbrIJL6SrpY0tOS7s2TmjTdZo3c19z4eEfS4U22+bakaJweNA/eOiOXO03SBhXb7iPpqfzYpwPfy3WSlmjnPqMlXdNRMVRxvBbPS8U2/SRdK+mJPMnLiU3W7y7psbzurxXLmz2vkjaU9HA+5hlq79B7s4UREX740W0fQK8aHuubwO/y8z2Bi9vYvifwMrBixbLlSSPJnwcG52XjgOtJl4RtAtyblw8Cnsl/L5mfL1nHcz0auKaGx2v2vDTZph+wZX7eh3R9/Nj8ejXgwcZzBizT1nkF7svHUj722Hqdbz/K93AN2+qipSkv1WTqzbxsgKQ/5ZrNNEmfz8vfq9hvN0nn5ufnSvqdpHuBX0raSNI/JT0o6R5Ja+Tteko6SelmHdMkHSppK0lXVpS7raQrqnxbuwDn5eeXAlu3UQPbGvh3RDxfsexU4Luk65oryz0/kknAEvnSr+2BmyLijYh4E7gJGJPj/oPydKaV8rn5raRJkp7JteJzJD3eeP7yds9JGiypf66hPpTP0x55/ah8Lh+SdJ+kgU2O09I5XztvPzWf89VaOkYVWjov80TEBxFxW34+G3gAGJZXfx34TT53RMSreXmz5zWXvVhETIqIII3mH19lrGYLzROnWL38z5SXpC6a+abezNv+kDSd57oAktq6fhjSl/JmEdEgaTFg84iYK2kb4GfA50mXSK0EjMjrBgFvAmdJWjrSZVT7kacIlXQxafrQpk6JiPOBocALALm8t4GlgJktxLgncGHjC0m7ANMj4qEmeX5eudmLeVlLy4mI/Vs5N0sCmwI7A1cBnwb2J30OIyJiasW2Y4CXImKHHOPikvqQLinbIyIm5/M7q8kxnqD5c34QcHpEXJDL6UmqKc93jPz3qTR/PfpFEXFiK+9/RnNvOjfx7wScnhetnpffneM4LiJuaKXcofl50+VmNeGEbfXS3JSXS9P81JvbkJIbeXk1U2r+LdI0n5AmADlP0mqkmmvvinJ/FxFzK48n6c/AlyX9iZTYvpLXV1vza1NOVjsD38+v+wE/IE1d2tmujoiQ9DDwSkQ8nGN4lPQDpjJhPwycLOkXpObuOyWtC8yIiMkAkSZMaTqTWkvn/J/A/0kaBlweac7x/zlGLveIjnrDSvO7XwicERHP5MW9SP/uRpN+4N2R35tZl+Qmcas5zT/l5XqkfsSWprxsTWWzcdP9K6cD/QlwW6TbXu5UxbH+BHwZ+CIp8c/NcV+s+QeMNT6+kvebTvrx0ZggFifNu92cscADEfFKfr0KsDLwkKTnSAnkAUmfqCw3G5aXtbS8LR/lvz+ueN74er4f8RHxJOnmJQ8DJyjd6KMazZ7ziPgr6YfKLOA6SVu1dAylu4E1d76Pzsdoz/ufADwVEadVLHsRuCoi5uQfiU+SEnhr53tYM8vNasIJ2+qhpSkvW5p68ybg4MadK5rEX5G0lqQeQGNtvaXjNX6x7lux/CbgwJxc5x0vIl4CXgKOISVv8vI9It3vuunj/LzJVUDjiOLdgFtzX2dzvkhFc3hEPBwRy0TEShGxEimZbBARL+dyv6JkE1L3wAzS4LTtJC2Zz8l2eRmSzpe0USvnpCqSlgM+iIi/AL8iJdZ/AUMkjcrbDNT/3uu72XMu6ZPAMxFxBvB30o1QmjsGEXFEC+e7caR3S+el6Xs4IcdzeJNVV5Jq1yiNyF+dNMCs2fOay35H0iZKzQlfye/BrCacsK0emp3yMlqeevMEYMk8IOkh/tuveTRwDXAPLfRbZr8Efi7pQeavQf6BND3ntFzulyrWXQC8EBGPt+N9/RFYStLTwJE5PiQtJ+m6xo2U5g7fFri8ynKvIyWSp0l9/N+EeU34PwEm58fxFd0InyL96FhY6wL3Kd2F7EfACXnw1h7w/+3dsU0DMRQG4N/7sAYjwBD0VBkD2gyCUmSChCYljJABqB6FTUOCDiSUyNL31Sef9XTSL/tZvjyNum1yumvxU83vkxzGeDfpB7dO3vHLuZ2tS5KMsTK23lfpvy3djxX6V3//Jcmx9etbt0keq+q4UNeH9O/mLcl7+klxuAhXk8IZrbXnJK9Vtb72XP5qHAJbV9XdtecC/B+BDd+01nbpPfDbqvpYeh7gEgQ2AExADxsAJiCwAWACAhsAJiCwAWACAhsAJiCwAWACnwEGTFTZQoeSAAAAAElFTkSuQmCC\n","text/plain":["<Figure size 576x432 with 2 Axes>"]},"metadata":{"tags":[],"needs_background":"light"}}]},{"cell_type":"code","metadata":{"id":"UOskcnfDQfBZ"},"source":["sample_label = torch.tensor(sample['labels'])\n"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"JkMK5VqJJvSO","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607482018264,"user_tz":480,"elapsed":45924,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"5c042ed1-6249-4e64-af53-1ce83e2a7403"},"source":["full_train_data = torch.utils.data.ConcatDataset([train_data, val_data])\n","full_train_sampler = RandomSampler(full_train_data)\n","full_train_dataloader = DataLoader(full_train_data, sampler=full_train_sampler, batch_size=32)\n","bert_classifier, optimizer, scheduler = initialize_model(epochs=2)\n","train(bert_classifier, full_train_dataloader, epochs=1)"],"execution_count":334,"outputs":[{"output_type":"stream","text":[" Epoch  |  Batch  |  Train Loss  |  Val Loss  |  Val Acc  |  Elapsed \n","----------------------------------------------------------------------\n","   1    |   20    |   1.074350   |     -      |     -     |   6.53   \n","   1    |   40    |   1.070863   |     -      |     -     |   6.18   \n","   1    |   60    |   0.999251   |     -      |     -     |   6.17   \n","   1    |   80    |   1.000841   |     -      |     -     |   6.19   \n","   1    |   100   |   0.988751   |     -      |     -     |   6.20   \n","   1    |   120   |   0.995561   |     -      |     -     |   6.18   \n","   1    |   130   |   0.996456   |     -      |     -     |   2.88   \n","----------------------------------------------------------------------\n","\n","\n","Training complete!\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"fc3Xe8Vp_wf1"},"source":["train(bert_classifier, full_train_dataloader, epochs=2)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"keZJnjUQ2F5X","colab":{"resources":{"http://localhost:8080/nbextensions/google.colab/files.js":{"data":"Ly8gQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQwovLwovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgovLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKLy8KLy8gICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKLy8KLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQovLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAovLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KLy8gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAovLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCi8qKgogKiBAZmlsZW92ZXJ2aWV3IEhlbHBlcnMgZm9yIGdvb2dsZS5jb2xhYiBQeXRob24gbW9kdWxlLgogKi8KKGZ1bmN0aW9uKHNjb3BlKSB7CmZ1bmN0aW9uIHNwYW4odGV4dCwgc3R5bGVBdHRyaWJ1dGVzID0ge30pIHsKICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogIGVsZW1lbnQudGV4dENvbnRlbnQgPSB0ZXh0OwogIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHN0eWxlQXR0cmlidXRlcykpIHsKICAgIGVsZW1lbnQuc3R5bGVba2V5XSA9IHN0eWxlQXR0cmlidXRlc1trZXldOwogIH0KICByZXR1cm4gZWxlbWVudDsKfQoKLy8gTWF4IG51bWJlciBvZiBieXRlcyB3aGljaCB3aWxsIGJlIHVwbG9hZGVkIGF0IGEgdGltZS4KY29uc3QgTUFYX1BBWUxPQURfU0laRSA9IDEwMCAqIDEwMjQ7CgpmdW5jdGlvbiBfdXBsb2FkRmlsZXMoaW5wdXRJZCwgb3V0cHV0SWQpIHsKICBjb25zdCBzdGVwcyA9IHVwbG9hZEZpbGVzU3RlcChpbnB1dElkLCBvdXRwdXRJZCk7CiAgY29uc3Qgb3V0cHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG91dHB1dElkKTsKICAvLyBDYWNoZSBzdGVwcyBvbiB0aGUgb3V0cHV0RWxlbWVudCB0byBtYWtlIGl0IGF2YWlsYWJsZSBmb3IgdGhlIG5leHQgY2FsbAogIC8vIHRvIHVwbG9hZEZpbGVzQ29udGludWUgZnJvbSBQeXRob24uCiAgb3V0cHV0RWxlbWVudC5zdGVwcyA9IHN0ZXBzOwoKICByZXR1cm4gX3VwbG9hZEZpbGVzQ29udGludWUob3V0cHV0SWQpOwp9CgovLyBUaGlzIGlzIHJvdWdobHkgYW4gYXN5bmMgZ2VuZXJhdG9yIChub3Qgc3VwcG9ydGVkIGluIHRoZSBicm93c2VyIHlldCksCi8vIHdoZXJlIHRoZXJlIGFyZSBtdWx0aXBsZSBhc3luY2hyb25vdXMgc3RlcHMgYW5kIHRoZSBQeXRob24gc2lkZSBpcyBnb2luZwovLyB0byBwb2xsIGZvciBjb21wbGV0aW9uIG9mIGVhY2ggc3RlcC4KLy8gVGhpcyB1c2VzIGEgUHJvbWlzZSB0byBibG9jayB0aGUgcHl0aG9uIHNpZGUgb24gY29tcGxldGlvbiBvZiBlYWNoIHN0ZXAsCi8vIHRoZW4gcGFzc2VzIHRoZSByZXN1bHQgb2YgdGhlIHByZXZpb3VzIHN0ZXAgYXMgdGhlIGlucHV0IHRvIHRoZSBuZXh0IHN0ZXAuCmZ1bmN0aW9uIF91cGxvYWRGaWxlc0NvbnRpbnVlKG91dHB1dElkKSB7CiAgY29uc3Qgb3V0cHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG91dHB1dElkKTsKICBjb25zdCBzdGVwcyA9IG91dHB1dEVsZW1lbnQuc3RlcHM7CgogIGNvbnN0IG5leHQgPSBzdGVwcy5uZXh0KG91dHB1dEVsZW1lbnQubGFzdFByb21pc2VWYWx1ZSk7CiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXh0LnZhbHVlLnByb21pc2UpLnRoZW4oKHZhbHVlKSA9PiB7CiAgICAvLyBDYWNoZSB0aGUgbGFzdCBwcm9taXNlIHZhbHVlIHRvIG1ha2UgaXQgYXZhaWxhYmxlIHRvIHRoZSBuZXh0CiAgICAvLyBzdGVwIG9mIHRoZSBnZW5lcmF0b3IuCiAgICBvdXRwdXRFbGVtZW50Lmxhc3RQcm9taXNlVmFsdWUgPSB2YWx1ZTsKICAgIHJldHVybiBuZXh0LnZhbHVlLnJlc3BvbnNlOwogIH0pOwp9CgovKioKICogR2VuZXJhdG9yIGZ1bmN0aW9uIHdoaWNoIGlzIGNhbGxlZCBiZXR3ZWVuIGVhY2ggYXN5bmMgc3RlcCBvZiB0aGUgdXBsb2FkCiAqIHByb2Nlc3MuCiAqIEBwYXJhbSB7c3RyaW5nfSBpbnB1dElkIEVsZW1lbnQgSUQgb2YgdGhlIGlucHV0IGZpbGUgcGlja2VyIGVsZW1lbnQuCiAqIEBwYXJhbSB7c3RyaW5nfSBvdXRwdXRJZCBFbGVtZW50IElEIG9mIHRoZSBvdXRwdXQgZGlzcGxheS4KICogQHJldHVybiB7IUl0ZXJhYmxlPCFPYmplY3Q+fSBJdGVyYWJsZSBvZiBuZXh0IHN0ZXBzLgogKi8KZnVuY3Rpb24qIHVwbG9hZEZpbGVzU3RlcChpbnB1dElkLCBvdXRwdXRJZCkgewogIGNvbnN0IGlucHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlucHV0SWQpOwogIGlucHV0RWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlOwoKICBjb25zdCBvdXRwdXRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3V0cHV0SWQpOwogIG91dHB1dEVsZW1lbnQuaW5uZXJIVE1MID0gJyc7CgogIGNvbnN0IHBpY2tlZFByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7CiAgICAgIHJlc29sdmUoZS50YXJnZXQuZmlsZXMpOwogICAgfSk7CiAgfSk7CgogIGNvbnN0IGNhbmNlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogIGlucHV0RWxlbWVudC5wYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKGNhbmNlbCk7CiAgY2FuY2VsLnRleHRDb250ZW50ID0gJ0NhbmNlbCB1cGxvYWQnOwogIGNvbnN0IGNhbmNlbFByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgY2FuY2VsLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgIHJlc29sdmUobnVsbCk7CiAgICB9OwogIH0pOwoKICAvLyBXYWl0IGZvciB0aGUgdXNlciB0byBwaWNrIHRoZSBmaWxlcy4KICBjb25zdCBmaWxlcyA9IHlpZWxkIHsKICAgIHByb21pc2U6IFByb21pc2UucmFjZShbcGlja2VkUHJvbWlzZSwgY2FuY2VsUHJvbWlzZV0pLAogICAgcmVzcG9uc2U6IHsKICAgICAgYWN0aW9uOiAnc3RhcnRpbmcnLAogICAgfQogIH07CgogIGNhbmNlbC5yZW1vdmUoKTsKCiAgLy8gRGlzYWJsZSB0aGUgaW5wdXQgZWxlbWVudCBzaW5jZSBmdXJ0aGVyIHBpY2tzIGFyZSBub3QgYWxsb3dlZC4KICBpbnB1dEVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlOwoKICBpZiAoIWZpbGVzKSB7CiAgICByZXR1cm4gewogICAgICByZXNwb25zZTogewogICAgICAgIGFjdGlvbjogJ2NvbXBsZXRlJywKICAgICAgfQogICAgfTsKICB9CgogIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykgewogICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpOwogICAgbGkuYXBwZW5kKHNwYW4oZmlsZS5uYW1lLCB7Zm9udFdlaWdodDogJ2JvbGQnfSkpOwogICAgbGkuYXBwZW5kKHNwYW4oCiAgICAgICAgYCgke2ZpbGUudHlwZSB8fCAnbi9hJ30pIC0gJHtmaWxlLnNpemV9IGJ5dGVzLCBgICsKICAgICAgICBgbGFzdCBtb2RpZmllZDogJHsKICAgICAgICAgICAgZmlsZS5sYXN0TW9kaWZpZWREYXRlID8gZmlsZS5sYXN0TW9kaWZpZWREYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygpIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ24vYSd9IC0gYCkpOwogICAgY29uc3QgcGVyY2VudCA9IHNwYW4oJzAlIGRvbmUnKTsKICAgIGxpLmFwcGVuZENoaWxkKHBlcmNlbnQpOwoKICAgIG91dHB1dEVsZW1lbnQuYXBwZW5kQ2hpbGQobGkpOwoKICAgIGNvbnN0IGZpbGVEYXRhUHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZSkgPT4gewogICAgICAgIHJlc29sdmUoZS50YXJnZXQucmVzdWx0KTsKICAgICAgfTsKICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGUpOwogICAgfSk7CiAgICAvLyBXYWl0IGZvciB0aGUgZGF0YSB0byBiZSByZWFkeS4KICAgIGxldCBmaWxlRGF0YSA9IHlpZWxkIHsKICAgICAgcHJvbWlzZTogZmlsZURhdGFQcm9taXNlLAogICAgICByZXNwb25zZTogewogICAgICAgIGFjdGlvbjogJ2NvbnRpbnVlJywKICAgICAgfQogICAgfTsKCiAgICAvLyBVc2UgYSBjaHVua2VkIHNlbmRpbmcgdG8gYXZvaWQgbWVzc2FnZSBzaXplIGxpbWl0cy4gU2VlIGIvNjIxMTU2NjAuCiAgICBsZXQgcG9zaXRpb24gPSAwOwogICAgd2hpbGUgKHBvc2l0aW9uIDwgZmlsZURhdGEuYnl0ZUxlbmd0aCkgewogICAgICBjb25zdCBsZW5ndGggPSBNYXRoLm1pbihmaWxlRGF0YS5ieXRlTGVuZ3RoIC0gcG9zaXRpb24sIE1BWF9QQVlMT0FEX1NJWkUpOwogICAgICBjb25zdCBjaHVuayA9IG5ldyBVaW50OEFycmF5KGZpbGVEYXRhLCBwb3NpdGlvbiwgbGVuZ3RoKTsKICAgICAgcG9zaXRpb24gKz0gbGVuZ3RoOwoKICAgICAgY29uc3QgYmFzZTY0ID0gYnRvYShTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGNodW5rKSk7CiAgICAgIHlpZWxkIHsKICAgICAgICByZXNwb25zZTogewogICAgICAgICAgYWN0aW9uOiAnYXBwZW5kJywKICAgICAgICAgIGZpbGU6IGZpbGUubmFtZSwKICAgICAgICAgIGRhdGE6IGJhc2U2NCwKICAgICAgICB9LAogICAgICB9OwogICAgICBwZXJjZW50LnRleHRDb250ZW50ID0KICAgICAgICAgIGAke01hdGgucm91bmQoKHBvc2l0aW9uIC8gZmlsZURhdGEuYnl0ZUxlbmd0aCkgKiAxMDApfSUgZG9uZWA7CiAgICB9CiAgfQoKICAvLyBBbGwgZG9uZS4KICB5aWVsZCB7CiAgICByZXNwb25zZTogewogICAgICBhY3Rpb246ICdjb21wbGV0ZScsCiAgICB9CiAgfTsKfQoKc2NvcGUuZ29vZ2xlID0gc2NvcGUuZ29vZ2xlIHx8IHt9OwpzY29wZS5nb29nbGUuY29sYWIgPSBzY29wZS5nb29nbGUuY29sYWIgfHwge307CnNjb3BlLmdvb2dsZS5jb2xhYi5fZmlsZXMgPSB7CiAgX3VwbG9hZEZpbGVzLAogIF91cGxvYWRGaWxlc0NvbnRpbnVlLAp9Owp9KShzZWxmKTsK","ok":true,"headers":[["content-type","application/javascript"]],"status":200,"status_text":""}},"base_uri":"https://localhost:8080/","height":75},"executionInfo":{"status":"ok","timestamp":1607240189071,"user_tz":300,"elapsed":131541,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"7e07e680-196f-4c9d-ab2a-5e343e14886d"},"source":["from google.colab import files\n","uploaded = files.upload()"],"execution_count":null,"outputs":[{"output_type":"display_data","data":{"text/html":["\n","     <input type=\"file\" id=\"files-665ec7cf-c9ef-41f4-b085-0d6ce69a33fb\" name=\"files[]\" multiple disabled\n","        style=\"border:none\" />\n","     <output id=\"result-665ec7cf-c9ef-41f4-b085-0d6ce69a33fb\">\n","      Upload widget is only available when the cell has been executed in the\n","      current browser session. Please rerun this cell to enable.\n","      </output>\n","      <script src=\"/nbextensions/google.colab/files.js\"></script> "],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["Saving Total_12-2-20.csv to Total_12-2-20.csv\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"dqYhin2P3Ga3","executionInfo":{"status":"ok","timestamp":1607560943248,"user_tz":480,"elapsed":767,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["#df = pd.read_csv('Total_11-23-20.csv')\n","df = pd.read_csv('renewables_topic_tweets.csv')"],"execution_count":29,"outputs":[]},{"cell_type":"code","metadata":{"id":"jGlsy8aH--at"},"source":["pd.set_option('display.max_colwidth', -1)\n","sample.tail(5)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"GIYvodDc_U9R"},"source":["sample_label = [0,1,1,2,1,2,1,2,1,2,\n","         2,0,1,2,2,1,1,1,2,1,\n","        0,1,1,1,1,2,2,2,0,1,\n","         0,2,1,1,0,1,0,0,2,2,\n","         2,2,1,2,2,2,1,1,1,1,\n","         1,1,2,1,1,1,2,2,1,2,\n","         0,1,1,1,0,2,1,1,0,1,\n","         2,2,1,1,1,2,2,2,1,1,\n","         1,1,1,0,1,1,1,2,1,2,\n","         1,2,1,2,2,0,2,0,2,2]"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"k29UQmLCDo4E"},"source":["sample_labels = torch.tensor(sample['labels'])\n","sample_inputs, sample_masks = preprocessing_for_bert(sample.text)\n","batch_size = 8\n","sample_data = TensorDataset(sample_inputs, sample_masks, sample_labels)\n","sample_sampler =  SequentialSampler(sample_data)\n","sample_dataloader = DataLoader(sample_data, sampler=sample_sampler, batch_size=batch_size)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"GiT6W3OXRWv0"},"source":["probss = bert_predict(bert_classifier, sample_dataloader)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"N9QIpW7vRjaI"},"source":["preds = np.argmax(probss, axis=1).flatten()"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"-tjv50G1SCUd"},"source":["print(accuracy_score(preds,sample['labels']))\n","print(f1_score(preds,sample['labels'],average='micro'))\n","print(f1_score(preds,sample['labels'],average='macro'))\n","print(f1_score(preds,sample['labels'],average='weighted'))"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":246},"id":"XMs4LViqDwp7","executionInfo":{"status":"ok","timestamp":1607241686115,"user_tz":300,"elapsed":574,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"b2fce2f9-00b5-469e-a0ce-ff14c0ddf1f0"},"source":["sample.sample(5)"],"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>index</th>\n","      <th>text</th>\n","      <th>labels</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>58</th>\n","      <td>58</td>\n","      <td>U.S. nuclear power plants avoided more than 470 million metric tons of carbon emissions in 2019—more than all other clean energy sources combined. https://t.co/9F0BtVm1Kz</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>0</th>\n","      <td>0</td>\n","      <td>Facts: \\r\\n\\r\\nChernobyl doesn't prove that nuclear energy is dangerous — it shows the failures of the Communist Soviet Union!\\r\\n\\r\\nThe accident turned into a catastrophe because of pitiful safety procedures.\\r\\n\\r\\nEven so, initial reports of radiation turned out to be grossly exaggerated.</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>2</td>\n","      <td>Nice resource on global nuclear energy statistics. https://t.co/ADeticP4ia</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>70</th>\n","      <td>70</td>\n","      <td>Great meeting today with @DeptofDefense on nuclear technology for space applications!  Looking forward to continued collaboration on several exciting fronts! https://t.co/9q4w55fcGw</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>77</th>\n","      <td>77</td>\n","      <td>🚀Space\\r\\n⚡️Energy\\r\\n💊Medicine\\r\\n🔎Crime\\r\\n🚜Agriculture\\r\\n\\r\\n@GovNuclear explores ✋ ways nuclear helps power our lives. \\r\\n#NuclearSciWeek\\r\\nhttps://t.co/o23DrKOOZc</td>\n","      <td>2</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["    index  ... labels\n","58  58     ...  1    \n","0   0      ...  0    \n","2   2      ...  1    \n","70  70     ...  2    \n","77  77     ...  2    \n","\n","[5 rows x 3 columns]"]},"metadata":{"tags":[]},"execution_count":107}]},{"cell_type":"code","metadata":{"id":"qWaV_aZYccik","executionInfo":{"status":"ok","timestamp":1607564278042,"user_tz":480,"elapsed":808,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["test = pd.read_csv('renewables_topic_tweets.csv')"],"execution_count":23,"outputs":[]},{"cell_type":"code","metadata":{"id":"56QTDchdOHBL","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607564595340,"user_tz":480,"elapsed":1188,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"af35a3ab-38de-4d3d-f226-6fbb73da73ba"},"source":["print('Tokenizing data...')\n","test_inputs, test_masks = preprocessing_for_bert(test.text)\n","test_dataset = TensorDataset(test_inputs, test_masks)\n","test_sampler = SequentialSampler(test_dataset)\n","test_dataloader = DataLoader(test_dataset, sampler=test_sampler, batch_size=8)"],"execution_count":55,"outputs":[{"output_type":"stream","text":["Tokenizing data...\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"XNMGNKgYGpEr"},"source":["train(bert_classifier, train_dataloader, epochs=1)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"tGx8h7yXRkfI","executionInfo":{"status":"ok","timestamp":1607565342071,"user_tz":480,"elapsed":1833,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["probs = bert_predict(bert_classifier, test_dataloader)\n","preds = np.argmax(probs, axis=1).flatten()"],"execution_count":72,"outputs":[]},{"cell_type":"code","metadata":{"id":"AeSvpL_22xvT","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607565342071,"user_tz":480,"elapsed":1135,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"7ac49da7-318e-4ec9-89b4-defb7990d74d"},"source":["test['sentiment'] = preds\n","test['sentiment'].value_counts()"],"execution_count":73,"outputs":[{"output_type":"execute_result","data":{"text/plain":["2    546\n","1    372\n","Name: sentiment, dtype: int64"]},"metadata":{"tags":[]},"execution_count":73}]},{"cell_type":"code","metadata":{"id":"LEGVh9DFckfJ","executionInfo":{"status":"ok","timestamp":1607483518421,"user_tz":480,"elapsed":790,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["p1 = preds"],"execution_count":380,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"tDld7aOga_gv","executionInfo":{"status":"ok","timestamp":1607483524119,"user_tz":480,"elapsed":791,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"64d2b353-34d0-41a4-989a-0e8b56834ec1"},"source":["test['sentiment'].value_counts()"],"execution_count":381,"outputs":[{"output_type":"execute_result","data":{"text/plain":["2    12187\n","0     4255\n","1     2843\n","Name: sentiment, dtype: int64"]},"metadata":{"tags":[]},"execution_count":381}]},{"cell_type":"code","metadata":{"id":"a6RRSPD0W5SM","executionInfo":{"status":"ok","timestamp":1607483574228,"user_tz":480,"elapsed":829,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["test.to_csv('final_p.csv')"],"execution_count":387,"outputs":[]},{"cell_type":"code","metadata":{"id":"KkgrQfBF32eg"},"source":["test.head(5)"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"RMq8ItUWVZkl","executionInfo":{"status":"ok","timestamp":1607477267442,"user_tz":480,"elapsed":818,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["test.to_csv('final_predication2.csv')"],"execution_count":130,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"5oX8nBVdI27E","executionInfo":{"status":"ok","timestamp":1607477746292,"user_tz":480,"elapsed":429,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"8da3c4f6-7a7c-42aa-bbd3-953850e4a262"},"source":["len(test['user_id'].value_counts())"],"execution_count":156,"outputs":[{"output_type":"execute_result","data":{"text/plain":["5477"]},"metadata":{"tags":[]},"execution_count":156}]},{"cell_type":"code","metadata":{"id":"YjeLQW0kTe1-","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607380082469,"user_tz":300,"elapsed":59205,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"411bf5c7-087d-4f6d-e301-6ec3d9d8515d"},"source":["len(df.user_id.value_counts())"],"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["11334"]},"metadata":{"tags":[]},"execution_count":44}]},{"cell_type":"code","metadata":{"id":"3F3PTtXWUUBN"},"source":["test['sentiment'][test['sentiment'] == 0] = -1\n","test['sentiment'][test['sentiment'] == 1] = 0\n","test['sentiment'][test['sentiment'] == 2] = 1"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"yQe3I3FWXIgp"},"source":["sample"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"ycIDBpXQTsgW","colab":{"base_uri":"https://localhost:8080/","height":255},"executionInfo":{"status":"ok","timestamp":1607484486895,"user_tz":480,"elapsed":568,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"3bf43de5-a038-4e46-b971-869d1de21562"},"source":["av = pd.DataFrame(test.groupby(['sentiment','user_id']).count())\n","av.head(5)"],"execution_count":392,"outputs":[{"output_type":"execute_result","data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th></th>\n","      <th>status_id</th>\n","      <th>time_retrieved</th>\n","      <th>text</th>\n","      <th>created_at</th>\n","      <th>favorite_count</th>\n","      <th>retweet_count</th>\n","      <th>place</th>\n","      <th>coordinates</th>\n","      <th>screen_name</th>\n","      <th>user_description</th>\n","      <th>user_follower_count</th>\n","      <th>verified</th>\n","      <th>user_location</th>\n","      <th>City</th>\n","      <th>State</th>\n","      <th>Country</th>\n","    </tr>\n","    <tr>\n","      <th>sentiment</th>\n","      <th>user_id</th>\n","      <th></th>\n","      <th></th>\n","      <th></th>\n","      <th></th>\n","      <th></th>\n","      <th></th>\n","      <th></th>\n","      <th></th>\n","      <th></th>\n","      <th></th>\n","      <th></th>\n","      <th></th>\n","      <th></th>\n","      <th></th>\n","      <th></th>\n","      <th></th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th rowspan=\"5\" valign=\"top\">-1</th>\n","      <th>11351.0</th>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>741803.0</th>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>784519.0</th>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>876641.0</th>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>1032541.0</th>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                     status_id  time_retrieved  text  ...  City  State  Country\n","sentiment user_id                                     ...                      \n","-1        11351.0            2               2     2  ...     2      2        2\n","          741803.0           2               2     2  ...     2      2        2\n","          784519.0           1               1     1  ...     1      1        1\n","          876641.0           1               1     1  ...     1      1        1\n","          1032541.0          1               1     1  ...     1      1        1\n","\n","[5 rows x 16 columns]"]},"metadata":{"tags":[]},"execution_count":392}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"nfTZuG60gFVX","executionInfo":{"status":"ok","timestamp":1607483812192,"user_tz":480,"elapsed":793,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"8349afad-d285-44a5-9a82-129c0c952370"},"source":["len(score)"],"execution_count":389,"outputs":[{"output_type":"execute_result","data":{"text/plain":["5477"]},"metadata":{"tags":[]},"execution_count":389}]},{"cell_type":"code","metadata":{"id":"TjyeAP6bVjgt","executionInfo":{"status":"ok","timestamp":1607483670451,"user_tz":480,"elapsed":505,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}}},"source":["score.to_csv('User_sentiments.csv')"],"execution_count":388,"outputs":[]},{"cell_type":"code","metadata":{"id":"QdbgAgeuUee7","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607483554054,"user_tz":480,"elapsed":756,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"ab2f9d5e-6df2-4999-ad4b-f6db9d40783b"},"source":["len(score[score['sentiment']>0])"],"execution_count":384,"outputs":[{"output_type":"execute_result","data":{"text/plain":["3559"]},"metadata":{"tags":[]},"execution_count":384}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"EtOGSotyi5Qg","executionInfo":{"status":"ok","timestamp":1607484558380,"user_tz":480,"elapsed":853,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"9f81b292-3b34-4ce8-dd46-93ad9d3187a5"},"source":["12187/3559"],"execution_count":393,"outputs":[{"output_type":"execute_result","data":{"text/plain":["3.4242764821579095"]},"metadata":{"tags":[]},"execution_count":393}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"01OJzgj0jrbJ","executionInfo":{"status":"ok","timestamp":1607484773523,"user_tz":480,"elapsed":807,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"b68dcf34-bd3f-4a1b-e899-5520e09b1386"},"source":["2843/1093"],"execution_count":394,"outputs":[{"output_type":"execute_result","data":{"text/plain":["2.6010978956999087"]},"metadata":{"tags":[]},"execution_count":394}]},{"cell_type":"code","metadata":{"id":"ukGrFh5vU-oC","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607483556659,"user_tz":480,"elapsed":756,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"b305ed65-b1ae-4155-cadd-858f94c85a2b"},"source":["len(score[score['sentiment']==0\n","          ])"],"execution_count":385,"outputs":[{"output_type":"execute_result","data":{"text/plain":["825"]},"metadata":{"tags":[]},"execution_count":385}]},{"cell_type":"code","metadata":{"id":"q7KKpr2gU-tP","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607483559191,"user_tz":480,"elapsed":507,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"49998cab-1a2c-4608-9c04-fca9e9f90729"},"source":["len(score[score['sentiment']<0])"],"execution_count":386,"outputs":[{"output_type":"execute_result","data":{"text/plain":["1093"]},"metadata":{"tags":[]},"execution_count":386}]},{"cell_type":"code","metadata":{"id":"vvDnB7ZXizva"},"source":["df_p = df[df['sentiment'] == 2]\n","df_n = df[df['sentiment'] == 0]\n","df_nn = df[df['sentiment'] == 1]"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"BygM7HhRio_J"},"source":["positive = pd.DataFrame(df_p['State'].value_counts())\n","negative = pd.DataFrame(df_n['State'].value_counts())\n","neutral = pd.DataFrame(df_nn['State'].value_counts())"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"hFJt71Mhmm6X"},"source":["neutral.reset_index(inplace = True)\n","neutral"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"-EjbsR60jMA2"},"source":["#positive.reset_index(inplace = True)\n","positive"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"vPr6LhBPj0DH"},"source":["negative.reset_index(inplace = True)\n","negative"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"R-ENcbuO6J2Z"},"source":["df['sentiment'][df['sentiment'] == 1] = 'neutral'\n","df['sentiment'][df['sentiment'] == 2] = 'positive'\n","df['sentiment'][df['sentiment'] == 0] = 'negative'"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"Jnoul29j3_I6"},"source":["df.to_csv('predication_result2.csv')"],"execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"c3W0x0w14-62","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1607249457619,"user_tz":300,"elapsed":21406,"user":{"displayName":"di wu","photoUrl":"","userId":"13335490941904566578"}},"outputId":"af775340-4c3d-48d0-d608-199372ae37ee"},"source":["from google.colab import drive\n","drive.mount('/content/gdrive')"],"execution_count":null,"outputs":[{"output_type":"stream","text":["Mounted at /content/gdrive\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"bBMi-I6xiBV0"},"source":["model_save_name = 'ELECTRA.pt'\n","path = F\"/content/gdrive/MyDrive/{model_save_name}\" \n","torch.save(bert_classifier.state_dict(), path)"],"execution_count":null,"outputs":[]}]}